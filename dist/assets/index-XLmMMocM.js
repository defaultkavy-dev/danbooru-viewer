var te=Object.defineProperty;var Et=r=>{throw TypeError(r)};var ee=(r,t,e)=>t in r?te(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e;var l=(r,t,e)=>ee(r,typeof t!="symbol"?t+"":t,e),Lt=(r,t,e)=>t.has(r)||Et("Cannot "+e);var M=(r,t,e)=>(Lt(r,t,"read from private field"),e?e.call(r):t.get(r)),z=(r,t,e)=>t.has(r)?Et("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(r):t.set(r,e),D=(r,t,e,s)=>(Lt(r,t,"write to private field"),s?s.call(r,e):t.set(r,e),e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const n of i)if(n.type==="childList")for(const o of n.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function e(i){const n={};return i.integrity&&(n.integrity=i.integrity),i.referrerPolicy&&(n.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?n.credentials="include":i.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(i){if(i.ep)return;i.ep=!0;const n=e(i);fetch(i.href,n)}})();class C{constructor(){this.eventMap=new Map}fire(t,...e){var s;return(s=this.eventMap.get(t))==null||s.forEach(i=>i(...e)),this}on(t,e){const s=this.eventMap.get(t)??this.eventMap.set(t,new Set).get(t);return s==null||s.add(e),this}off(t,e){var s;return(s=this.eventMap.get(t))==null||s.delete(e),this}once(t,e){const s=(...n)=>{var o;(o=this.eventMap.get(t))==null||o.delete(s),e(...n)},i=this.eventMap.get(t)??this.eventMap.set(t,new Set).get(t);return i==null||i.add(s),this}}class Rt{constructor(){this.domEvents={},this.events=new C}on(t,e,s){t=$.orArrayResolve(t);for(const i of t){this.domEvents[i]||(this.domEvents[i]=new Map);const n=o=>{e(o,this)};this.domEvents[i].set(e,n),this.events.on(i,e),this.dom.addEventListener(i,n,s)}return this}off(t,e,s){var n;const i=(n=this.domEvents[t])==null?void 0:n.get(e);return i&&this.dom.removeEventListener(t,i,s),this.events.off(t,e),this}once(t,e,s){const i=n=>{this.dom.removeEventListener(t,i,s),e(n,this)};return this.dom.addEventListener(t,i,s),this.events.once(t,e),this}trigger(t){this.dom.dispatchEvent(new Event(t))}}class I extends C{constructor(t,e){super(),this.attributes=new Map,this.linkStates=new Set,this.options={},this.set(t),e&&(this.options=e)}static create(t,e){return new I(t,e)}set(t,e){if(this._value=t,t instanceof I)t.linkStates.add(this);else if(t instanceof Object){const s=new Map(Object.entries(this));for(const[i,n]of Object.entries(t)){const o=s.get(`${i}$`);o instanceof I?o.set(n):Object.assign(this,{[`${i}$`]:$.state(n)})}}e!=null&&e.disableUpdate||this.update(),e!=null&&e.disableUpdateLink||this.linkStates.forEach(s=>s.update())}static toJSON(t){const e={};for(let[s,i]of Object.entries(t))i instanceof I?i=i.toJSON():i instanceof Object&&I.toJSON(i),Object.assign(e,{[s]:i});return e}update(){for(const[t,e]of this.attributes.entries())for(const s of e)t[s]instanceof Function?this.options.format?t[s](this.options.format(this.value)):t[s](this.value):s in t&&(t[s]=this.value);this.fire("update",{state$:this})}use(t,e){const s=this.attributes.get(t);s?s.add(e):this.attributes.set(t,new Set().add(e))}convert(t){const e=new I(this);return e._convert=t,e}get value(){return this._value instanceof I?this._convert?this._convert(this._value.value):this._value.value:this._value}toString(){return this.options.format?`${this.options.format(this.value)}`:this.value instanceof Object?JSON.stringify(this.toJSON()):`${this.value}`}toJSON(){return this.value instanceof I?this.value.toJSON():this.value instanceof Object?I.toJSON(this.value):this.toString()}isType(){return this._value===null||this._value===void 0?null:this}}class st extends Rt{constructor(){super(...arguments),this.__$property__={hidden:!1,coordinate:void 0}}hide(t,e=!0){return $.fluent(this,arguments,()=>this.__$property__.hidden,()=>{var s;if(t!==void 0)return t instanceof I?(this.__$property__.hidden=t.value,t.use(this,"hide")):this.__$property__.hidden=t,e&&((s=this.parent)==null||s.children.render()),this})}remove(){var t;return(t=this.parent)==null||t.children.remove(this).render(),this}replace(t){var e;return(e=this.parent)==null||e.children.replace(this,t).render(),this}contains(t){return t?t instanceof st?this.dom.contains(t.dom):t instanceof EventTarget?this.dom.contains($(t).dom):this.dom.contains(t):!1}coordinate(t){return $.fluent(this,arguments,()=>this.__$property__.coordinate,()=>$.set(this.__$property__,"coordinate",t))}self(t){return $.orArrayResolve(t).forEach(e=>e(this)),this}inDOM(){return document.contains(this.dom)}get element(){return this.dom instanceof Element?this:null}get htmlElement(){return this.dom instanceof HTMLElement?this:null}}var b;(r=>{function t(i){return i instanceof Array?i:[i]}r.orArrayResolve=t;function e(i,n){return t(n).forEach(o=>{Object.getOwnPropertyNames(o.prototype).forEach(a=>{a!=="constructor"&&Object.defineProperty(i.prototype,a,Object.getOwnPropertyDescriptor(o.prototype,a)||Object.create(null))})}),i}r.mixin=e;function s(i){return i.map(n=>n==null?void 0:n.split(" ").filter(o=>o.length)).flat().detype(void 0)}r.classlist=s})(b||(b={}));class Q extends st{constructor(t,e){super(),this.static_classes=new Set,this.dom=this.createDom(t,e),this.dom.$=this,this.setOptions(e)}createDom(t,e){return e!=null&&e.dom?e.dom:t==="svg"?document.createElementNS("http://www.w3.org/2000/svg","svg"):document.createElement((e==null?void 0:e.tagname)??t)}setOptions(t){return this.id(t==null?void 0:t.id),t&&t.class&&this.class(...t.class),this}id(t){return $.fluent(this,arguments,()=>this.dom.id,()=>$.set(this.dom,"id",t))}class(...t){return $.fluent(this,arguments,()=>this.dom.classList,()=>{this.dom.classList.forEach(e=>this.static_classes.has(e)??this.dom.classList.remove(e)),this.dom.classList.add(...b.classlist(t))})}addClass(...t){return $.fluent(this,arguments,()=>this,()=>{this.dom.classList.add(...b.classlist(t))})}removeClass(...t){return $.fluent(this,arguments,()=>this,()=>{this.dom.classList.remove(...b.classlist(t))})}staticClass(...t){return $.fluent(this,arguments,()=>this.static_classes,()=>{t=b.classlist(t),this.removeClass(...this.static_classes),this.static_classes.clear(),this.addStaticClass(...t)})}addStaticClass(...t){return $.fluent(this,arguments,()=>this,()=>{t=b.classlist(t),t.detype().forEach(e=>this.static_classes.add(e)),this.addClass(...t)})}removeStaticClass(...t){return $.fluent(this,arguments,()=>this,()=>{t=b.classlist(t),t.detype().forEach(e=>this.static_classes.delete(e)),this.removeClass(...t)})}css(t){return $.fluent(this,arguments,()=>this.dom.style,()=>{Object.assign(this.dom.style,t)})}attribute(t,e){return arguments.length?arguments.length===1?t===void 0?null:this.dom.getAttribute(t):arguments.length===2?t?(e===null?this.dom.removeAttribute(t):e!==void 0&&this.dom.setAttribute(t,`${e}`),this):this:this:null}tabIndex(t){return $.fluent(this,arguments,()=>this.dom.tabIndex,()=>$.set(this.dom,"tabIndex",t))}focus(t){return this.dom.focus(t),this}blur(){return this.dom.blur(),this}animate(t,e,s){const i=this.dom.animate(t,e);return s&&(i.onfinish=()=>s(i)),i}getAnimations(t){return this.dom.getAnimations(t)}get dataset(){return this.dom.dataset}domRect(t){const e=this.dom.getBoundingClientRect();if(!t)return e;const s=t instanceof Q?t.dom.getBoundingClientRect():t;return{...e,top:e.top-s.top,left:e.left-s.left,right:e.right-s.left,bottom:e.bottom-s.top,x:e.x-s.x,y:e.y-s.y}}}class at extends st{constructor(t){super(),this.dom=t,this.dom.$=this}domRect(t){const e={bottom:innerHeight,height:innerHeight,left:0,right:innerWidth,top:0,width:innerWidth,x:0,y:0};if(!t)return e;const s=t instanceof Q?t.dom.getBoundingClientRect():t;return{...e,top:e.top-s.top,left:e.left-s.left,right:e.right-s.left,bottom:e.bottom-s.top,x:e.x-s.x,y:e.y-s.y}}static from(t){return t.$ instanceof at?t.$:new at(t)}}const se="modulepreload",ie=function(r){return"/"+r},Pt={},re=function(t,e,s){let i=Promise.resolve();if(e&&e.length>0){document.getElementsByTagName("link");const o=document.querySelector("meta[property=csp-nonce]"),a=(o==null?void 0:o.nonce)||(o==null?void 0:o.getAttribute("nonce"));i=Promise.allSettled(e.map(h=>{if(h=ie(h),h in Pt)return;Pt[h]=!0;const u=h.endsWith(".css"),d=u?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${h}"]${d}`))return;const c=document.createElement("link");if(c.rel=u?"stylesheet":se,u||(c.as="script"),c.crossOrigin="",c.href=h,a&&c.setAttribute("nonce",a),document.head.appendChild(c),u)return new Promise((p,g)=>{c.addEventListener("load",p),c.addEventListener("error",()=>g(new Error(`Unable to preload CSS for ${h}`)))})}))}function n(o){const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=o,window.dispatchEvent(a),!a.defaultPrevented)throw o}return i.then(o=>{for(const a of o||[])a.status==="rejected"&&n(a.reason);return t().catch(n)})};class ne{constructor(t){this.childList=new Set,this.$container=t}add(t,e=-1){if(e===-1||this.childList.size-1===e)this.childList.add(t);else{const s=[...this.childList];s.splice(e,0,t),this.childList.clear(),s.forEach(i=>this.childList.add(i))}t.parent=this.$container}remove(t){return this.childList.has(t)?(this.childList.delete(t),t.parent=void 0,this):this}removeAll(t=!0){this.childList.forEach(e=>this.remove(e)),t&&this.render()}replace(t,e){const s=this.array;return s.splice(s.indexOf(t),1,e),t.remove(),this.childList.clear(),s.forEach(i=>this.childList.add(i)),e.parent=this.$container,this}render(){const[t,e]=[this.array.map(i=>i.dom),Array.from(this.dom.childNodes)],s=[];for(;e.length||t.length;){const[i,n]=[e.at(0),t.at(0)];n?i?n!==i?(n.$.hide()||(this.dom.insertBefore(n,i),s.push(n)),t.shift()):(n.$.hide()&&this.dom.removeChild(n),t.shift(),e.shift()):(n.$.hide()||this.dom.append(n),t.shift()):(i&&!s.includes(i)&&i.remove(),e.shift())}}indexOf(t){return this.array.indexOf(t)}get array(){return[...this.childList.values()]}get dom(){return this.$container.dom}}class J extends st{constructor(t){super(),this.dom=new Text(t),this.dom.$=this}content(t){return $.fluent(this,arguments,()=>this.dom.textContent,()=>$.set(this.dom,"textContent",t))}}class et extends Q{constructor(t,e){super(t,e)}autocapitalize(t){return $.fluent(this,arguments,()=>this.dom.autocapitalize,()=>$.set(this.dom,"autocapitalize",t))}innerText(t){return $.fluent(this,arguments,()=>this.dom.innerText,()=>$.set(this.dom,"innerText",t))}title(t){return $.fluent(this,arguments,()=>this.dom.title,()=>$.set(this.dom,"title",t))}dir(t){return $.fluent(this,arguments,()=>this.dom.dir,()=>$.set(this.dom,"dir",t))}translate(t){return $.fluent(this,arguments,()=>this.dom.translate,()=>$.set(this.dom,"translate",t))}popover(t){return $.fluent(this,arguments,()=>this.dom.popover,()=>$.set(this.dom,"popover",t))}spellcheck(t){return $.fluent(this,arguments,()=>this.dom.spellcheck,()=>$.set(this.dom,"spellcheck",t))}inert(t){return $.fluent(this,arguments,()=>this.dom.inert,()=>$.set(this.dom,"inert",t))}lang(t){return $.fluent(this,arguments,()=>this.dom.lang,()=>$.set(this.dom,"lang",t))}draggable(t){return $.fluent(this,arguments,()=>this.dom.draggable,()=>$.set(this.dom,"draggable",t))}hidden(t){return $.fluent(this,arguments,()=>this.dom.hidden,()=>$.set(this.dom,"hidden",t))}click(){return this.dom.click(),this}attachInternals(){return this.dom.attachInternals()}hidePopover(){return this.dom.hidePopover(),this}showPopover(){return this.dom.showPopover(),this}togglePopover(){return this.dom.togglePopover(),this}get accessKeyLabel(){return this.dom.accessKeyLabel}get offsetHeight(){return this.dom.offsetHeight}get offsetLeft(){return this.dom.offsetLeft}get offsetParent(){return $(this.dom.offsetParent)}get offsetTop(){return this.dom.offsetTop}get offsetWidth(){return this.dom.offsetWidth}}class f extends et{constructor(t,e){super(t,e),this.children=new ne(this),this.__position_cursor=0}content(t){return $.fluent(this,arguments,()=>this,()=>{this.children.removeAll(!1),this.insert(t)})}insert(t,e=-1){return $.fluent(this,arguments,()=>this,async()=>{if(t instanceof Function){let s=t(this);s instanceof Promise?t=await s:t=s}else t instanceof Promise&&(t=await t);t=$.orArrayResolve(t),this.__position_cursor=e<0?this.children.array.length+e:e;for(const s of t)if(s!=null){if(s instanceof Array)this.insert(s,this.__position_cursor);else if(typeof s=="string")this.children.add(new J(s),e);else if(s instanceof I){const i=new J(s.toString());s.use(i,"content"),this.children.add(i,e)}else if(s instanceof Promise){const i=(await re(async()=>{const{$Async:o}=await Promise.resolve().then(()=>de);return{$Async:o}},void 0)).$Async,n=new i().await(s);this.children.add(n,e)}else this.children.add(s,e);this.__position_cursor+=1}this.children.render()})}clear(){return this.children.removeAll(),this}$(t){if(t.startsWith("::"))return Array.from(this.dom.querySelectorAll(t.replace(/^::/,""))).map(e=>$(e));if(t.startsWith(":"))return $(this.dom.querySelector(t.replace(/^:/,"")))}get scrollHeight(){return this.dom.scrollHeight}get scrollWidth(){return this.dom.scrollWidth}scrollTop(t){return $.fluent(this,arguments,()=>this.dom.scrollTop,()=>$.set(this.dom,"scrollTop",t))}scrollLeft(t){return $.fluent(this,arguments,()=>this.dom.scrollLeft,()=>$.set(this.dom,"scrollLeft",t))}}class Ht extends f{constructor(t){super("a",t),this.dom.addEventListener("click",e=>{$.anchorHandler&&this.href()&&(e.preventDefault(),$.anchorHandler(this,e))})}href(t){return $.fluent(this,arguments,()=>this.dom.href,()=>$.set(this.dom,"href",t))}target(t){return $.fluent(this,arguments,()=>this.dom.target??void 0,()=>{t&&(this.dom.target=t)})}}class A{static create(...t){const e=class{};return Object.getOwnPropertyNames(A.prototype).forEach(s=>{s!=="constructor"&&t.includes(s)&&Object.defineProperty(e.prototype,s,Object.getOwnPropertyDescriptor(A.prototype,s)||Object.create(null))}),e}disabled(t){return $.fluent(this,arguments,()=>this.dom.disabled,()=>$.set(this.dom,"disabled",t))}checkValidity(){return this.dom.checkValidity()}reportValidity(){return this.dom.reportValidity()}formAction(t){return $.fluent(this,arguments,()=>this.dom.formAction,()=>$.set(this.dom,"formAction",t))}formEnctype(t){return $.fluent(this,arguments,()=>this.dom.formEnctype,()=>$.set(this.dom,"formEnctype",t))}formMethod(t){return $.fluent(this,arguments,()=>this.dom.formMethod,()=>$.set(this.dom,"formMethod",t))}formNoValidate(t){return $.fluent(this,arguments,()=>this.dom.formNoValidate,()=>$.set(this.dom,"formNoValidate",t))}formTarget(t){return $.fluent(this,arguments,()=>this.dom.formTarget,()=>$.set(this.dom,"formTarget",t))}autocomplete(t){return $.fluent(this,arguments,()=>this.dom.autocomplete,()=>$.set(this.dom,"autocomplete",t))}name(t){return $.fluent(this,arguments,()=>this.dom.name,()=>$.set(this.dom,"name",t))}maxLength(t){return $.fluent(this,arguments,()=>this.dom.maxLength,()=>$.set(this.dom,"maxLength",t))}minLength(t){return $.fluent(this,arguments,()=>this.dom.minLength,()=>$.set(this.dom,"minLength",t))}required(t){return $.fluent(this,arguments,()=>this.dom.required,()=>$.set(this.dom,"required",t))}label(t){return $.fluent(this,arguments,()=>this.dom.label,()=>$.set(this.dom,"label",t))}get form(){return this.dom.form?$(this.dom.form):null}get validationMessage(){return this.dom.validationMessage}get validity(){return this.dom.validity}get willValidate(){return this.dom.willValidate}}class Ot extends f{constructor(t){super("button",t)}type(t){return $.fluent(this,arguments,()=>this.dom.type,()=>$.set(this.dom,"type",t))}}b.mixin(Ot,A.create("disabled","checkValidity","formAction","formEnctype","formMethod","formNoValidate","formTarget","reportValidity"));class Nt extends f{constructor(t){super("form",t)}action(t){return $.fluent(this,arguments,()=>this.dom.formAction,()=>$.set(this.dom,"formAction",t))}enctype(t){return $.fluent(this,arguments,()=>this.dom.formEnctype,()=>$.set(this.dom,"formEnctype",t))}method(t){return $.fluent(this,arguments,()=>this.dom.formMethod,()=>$.set(this.dom,"formMethod",t))}noValidate(t){return $.fluent(this,arguments,()=>this.dom.formNoValidate,()=>$.set(this.dom,"formNoValidate",t))}acceptCharset(t){return $.fluent(this,arguments,()=>this.dom.acceptCharset,()=>$.set(this.dom,"acceptCharset",t))}target(t){return $.fluent(this,arguments,()=>this.dom.formTarget,()=>$.set(this.dom,"formTarget",t))}requestSubmit(){return this.dom.requestSubmit(),this}reset(){return this.dom.reset(),this}submit(){return this.dom.submit(),this}get length(){return this.dom.length}get elements(){return Array.from(this.dom.elements).map(t=>$(t))}}b.mixin(Nt,A.create("checkValidity","reportValidity","autocomplete"));class k extends et{constructor(t){super("input",t)}value(t){return $.fluent(this,arguments,()=>this.type()==="number"?Number(this.dom.value):this.dom.value,()=>$.set(this.dom,"value",t,e=>{this.on("input",()=>{e.attributes.has(this.dom)!==!1&&(typeof e.value=="string"&&e.set(`${this.value()}`,{disableUpdate:!0}),typeof e.value=="number"&&e.set(Number(this.value()),{disableUpdate:!0}))})}))}type(t){return $.fluent(this,arguments,()=>this.dom.type,()=>$.set(this.dom,"type",t))}capture(t){return $.fluent(this,arguments,()=>this.dom.capture,()=>$.set(this.dom,"capture",t))}alt(t){return $.fluent(this,arguments,()=>this.dom.alt,()=>$.set(this.dom,"alt",t))}height(t){return $.fluent(this,arguments,()=>this.dom.height,()=>$.set(this.dom,"height",t))}width(t){return $.fluent(this,arguments,()=>this.dom.width,()=>$.set(this.dom,"width",t))}defaultValue(t){return $.fluent(this,arguments,()=>this.dom.defaultValue,()=>$.set(this.dom,"defaultValue",t))}dirName(t){return $.fluent(this,arguments,()=>this.dom.dirName,()=>$.set(this.dom,"dirName",t))}pattern(t){return $.fluent(this,arguments,()=>this.dom.pattern,()=>$.set(this.dom,"pattern",t))}placeholder(t){return $.fluent(this,arguments,()=>this.dom.placeholder,()=>$.set(this.dom,"placeholder",t))}readOnly(t){return $.fluent(this,arguments,()=>this.dom.readOnly,()=>$.set(this.dom,"readOnly",t))}selectionDirection(t){return $.fluent(this,arguments,()=>this.dom.selectionDirection,()=>$.set(this.dom,"selectionDirection",t))}selectionEnd(t){return $.fluent(this,arguments,()=>this.dom.selectionEnd,()=>$.set(this.dom,"selectionEnd",t))}selectionStart(t){return $.fluent(this,arguments,()=>this.dom.selectionStart,()=>$.set(this.dom,"selectionStart",t))}size(t){return $.fluent(this,arguments,()=>this.dom.size,()=>$.set(this.dom,"size",t))}src(t){return $.fluent(this,arguments,()=>this.dom.src,()=>$.set(this.dom,"src",t))}inputMode(t){return $.fluent(this,arguments,()=>this.dom.inputMode,()=>$.set(this.dom,"inputMode",t))}valueAsDate(t){return $.fluent(this,arguments,()=>this.dom.valueAsDate,()=>$.set(this.dom,"valueAsDate",t))}valueAsNumber(t){return $.fluent(this,arguments,()=>this.dom.valueAsNumber,()=>$.set(this.dom,"valueAsNumber",t))}webkitdirectory(t){return $.fluent(this,arguments,()=>this.dom.webkitdirectory,()=>$.set(this.dom,"webkitdirectory",t))}select(){return this.dom.select(),this}setCustomValidity(t){return this.dom.setCustomValidity(t),this}setRangeText(t,e,s,i){return typeof e=="number"&&typeof s=="number"&&this.dom.setRangeText(t,e,s,i),this.dom.setRangeText(t),this}setSelectionRange(t,e,s){return this.dom.setSelectionRange(t,e,s),this}showPicker(){return this.dom.showPicker(),this}get files(){return this.dom.files}get webkitEntries(){return this.dom.webkitEntries}get labels(){return Array.from(this.dom.labels??[]).map(t=>$(t))}}b.mixin(k,A.create("checkValidity","reportValidity","autocomplete","name","form","required","validationMessage","validity","willValidate","formAction","formEnctype","formMethod","formNoValidate","formTarget"));class oe extends k{constructor(t){super(t),this.type("number")}static from(t){return $.mixin(k,this)}stepDown(){return this.dom.stepDown(),this}stepUp(){return this.dom.stepUp(),this}max(t){return $.fluent(this,arguments,()=>this.dom.max===""?null:parseInt(this.dom.min),()=>$.set(this.dom,"max",t==null?void 0:t.toString()))}min(t){return $.fluent(this,arguments,()=>this.dom.min===""?null:parseInt(this.dom.min),()=>$.set(this.dom,"min",t==null?void 0:t.toString()))}step(t){return $.fluent(this,arguments,()=>Number(this.dom.step),()=>$.set(this.dom,"step",t==null?void 0:t.toString()))}}class ae extends k{constructor(t){super(t),this.type("radio")}static from(t){return $.mixin(k,this)}checked(t){return $.fluent(this,arguments,()=>this.dom.checked,()=>$.set(this.dom,"checked",t))}defaultChecked(t){return $.fluent(this,arguments,()=>this.dom.defaultChecked,()=>$.set(this.dom,"defaultChecked",t))}}class he extends k{constructor(t){super(t),this.type("file")}static from(t){return $.mixin(k,this)}multiple(t){return $.fluent(this,arguments,()=>this.dom.multiple,()=>$.set(this.dom,"multiple",t))}accept(...t){return $.fluent(this,arguments,()=>this.dom.accept.split(","),()=>this.dom.accept=t.toString())}}b.mixin(k,[oe,ae,he]);class Ft extends f{constructor(t){super("label",t)}for(t){return $.fluent(this,arguments,()=>this.dom.htmlFor,()=>{$.set(this.dom,"htmlFor",t)})}get control(){return this.dom.control}}b.mixin(Ft,A.create("form"));class le extends et{constructor(t){super("img",t)}async load(t){return new Promise(e=>{const s=this.once("load",()=>{e(s)});typeof t=="string"?s.src(t):t.then(i=>s.src(i))})}static resize(t,e){return new Promise(s=>{const i=new Image;if(i.addEventListener("load",()=>{const n=document.createElement("canvas"),o=n.getContext("2d");if(!o)throw"$Image.resize: context undefined";const a=i.width/i.height,[h,u,d]=[a>1,a<1,a===1],c=e instanceof Array?e[0]:u?e:e*a,p=e instanceof Array?e[1]:h?e:e/a;n.height=p,n.width=c,o.drawImage(i,0,0,c,p),s(n.toDataURL())},{once:!0}),t instanceof File){const n=new FileReader;n.addEventListener("load",()=>i.src=n.result),n.readAsDataURL(t)}else i.src=t})}alt(t){return $.fluent(this,arguments,()=>this.dom.alt,()=>$.set(this.dom,"alt",t))}crossOrigin(t){return $.fluent(this,arguments,()=>this.dom.crossOrigin,()=>$.set(this.dom,"crossOrigin",t))}decoding(t){return $.fluent(this,arguments,()=>this.dom.decoding,()=>$.set(this.dom,"decoding",t))}height(t){return $.fluent(this,arguments,()=>this.dom.height,()=>$.set(this.dom,"height",t))}isMap(t){return $.fluent(this,arguments,()=>this.dom.isMap,()=>$.set(this.dom,"isMap",t))}loading(t){return $.fluent(this,arguments,()=>this.dom.loading,()=>$.set(this.dom,"loading",t))}referrerPolicy(t){return $.fluent(this,arguments,()=>this.dom.referrerPolicy,()=>$.set(this.dom,"referrerPolicy",t))}sizes(t){return $.fluent(this,arguments,()=>this.dom.sizes,()=>$.set(this.dom,"sizes",t))}src(t){return $.fluent(this,arguments,()=>this.dom.src,()=>$.set(this.dom,"src",t))}srcset(t){return $.fluent(this,arguments,()=>this.dom.srcset,()=>$.set(this.dom,"srcset",t))}useMap(t){return $.fluent(this,arguments,()=>this.dom.useMap,()=>$.set(this.dom,"useMap",t))}width(t){return $.fluent(this,arguments,()=>this.dom.width,()=>$.set(this.dom,"width",t))}decode(){return this.dom.decode()}get complete(){return this.dom.complete}get currentSrc(){return this.dom.currentSrc}get naturalHeight(){return this.dom.naturalHeight}get naturalWidth(){return this.dom.naturalWidth}get x(){return this.dom.x}get y(){return this.dom.y}}class ce extends f{constructor(t){super("canvas",t)}height(t){return $.fluent(this,arguments,()=>this.dom.height,()=>{$.set(this.dom,"height",t)})}width(t){return $.fluent(this,arguments,()=>this.dom.width,()=>{$.set(this.dom,"width",t)})}captureStream(t){return this.dom.captureStream(t)}getContext(t,e){return this.dom.getContext(t)}toBlob(t,e,s){return this.dom.toBlob(t,e,s),this}toDataURL(t,e){return this.dom.toDataURL(t,e)}transferControlToOffscreen(){return this.dom.transferControlToOffscreen()}}class ue extends f{constructor(t){super("dialog",t)}open(t){return $.fluent(this,arguments,()=>this.dom.open,()=>$.set(this.dom,"open",t))}returnValue(t){return $.fluent(this,arguments,()=>this.dom.returnValue,()=>$.set(this.dom,"returnValue",t))}close(){return this.dom.close(),this}show(){return this.dom.show(),this}showModal(){return this.dom.showModal(),this}}class Vt extends f{constructor(t){super("select")}add(t){return this.insert(t),this}item(t){return $(this.dom.item(t))}namedItem(t){return $(this.dom.namedItem(t))}multiple(t){return $.fluent(this,arguments,()=>this.dom.multiple,()=>$.set(this.dom,"multiple",t))}get length(){return this.dom.length}get size(){return this.dom.size}get options(){return Array.from(this.dom.options).map(t=>$(t))}get selectedIndex(){return this.dom.selectedIndex}get selectedOptions(){return Array.from(this.dom.selectedOptions).map(t=>$(t))}value(t){return $.fluent(this,arguments,()=>this.dom.value,()=>$.set(this.dom,"value",t,e=>{this.on("input",()=>{e.attributes.has(this.dom)!==!1&&(typeof e.value=="string"&&e.set(`${this.value()}`),typeof e.value=="number"&&e.set(Number(this.value())))})}))}get labels(){return Array.from(this.dom.labels??[]).map(t=>$(t))}}b.mixin(Vt,A.create("checkValidity","reportValidity","autocomplete","name","form","required","disabled","validationMessage","validity","willValidate"));class jt extends f{constructor(t){super("option",t)}defaultSelected(t){return $.fluent(this,arguments,()=>this.dom.defaultSelected,()=>$.set(this.dom,"defaultSelected",t))}selected(t){return $.fluent(this,arguments,()=>this.dom.selected,()=>$.set(this.dom,"selected",t))}text(t){return $.fluent(this,arguments,()=>this.dom.text,()=>$.set(this.dom,"text",t))}value(t){return $.fluent(this,arguments,()=>this.dom.value,()=>$.set(this.dom,"value",t))}get form(){return this.dom.form?$(this.dom.form):null}get index(){return this.dom.index}}b.mixin(jt,A.create("form","disabled","label"));class Wt extends f{constructor(t){super("optgroup",t)}disabled(t){return $.fluent(this,arguments,()=>this.dom.disabled,()=>$.set(this.dom,"disabled",t))}}b.mixin(Wt,A.create("disabled","label"));class Ut extends f{constructor(t){super("textarea",t)}cols(t){return $.fluent(this,arguments,()=>this.dom.cols,()=>$.set(this.dom,"cols",t))}wrap(t){return $.fluent(this,arguments,()=>this.dom.wrap,()=>$.set(this.dom,"wrap",t))}value(t){return $.fluent(this,arguments,()=>this.dom.value,()=>$.set(this.dom,"value",t))}defaultValue(t){return $.fluent(this,arguments,()=>this.dom.defaultValue,()=>$.set(this.dom,"defaultValue",t))}dirName(t){return $.fluent(this,arguments,()=>this.dom.dirName,()=>$.set(this.dom,"dirName",t))}placeholder(t){return $.fluent(this,arguments,()=>this.dom.placeholder,()=>$.set(this.dom,"placeholder",t))}readOnly(t){return $.fluent(this,arguments,()=>this.dom.readOnly,()=>$.set(this.dom,"readOnly",t))}selectionDirection(t){return $.fluent(this,arguments,()=>this.dom.selectionDirection,()=>$.set(this.dom,"selectionDirection",t))}selectionEnd(t){return $.fluent(this,arguments,()=>this.dom.selectionEnd,()=>$.set(this.dom,"selectionEnd",t))}selectionStart(t){return $.fluent(this,arguments,()=>this.dom.selectionStart,()=>$.set(this.dom,"selectionStart",t))}type(t){return $.fluent(this,arguments,()=>this.dom.type,()=>$.set(this.dom,"type",t))}inputMode(t){return $.fluent(this,arguments,()=>this.dom.inputMode,()=>$.set(this.dom,"inputMode",t))}select(){return this.dom.select(),this}setCustomValidity(t){return this.dom.setCustomValidity(t),this}setRangeText(t,e,s,i){return typeof e=="number"&&typeof s=="number"&&this.dom.setRangeText(t,e,s,i),this.dom.setRangeText(t),this}setSelectionRange(t,e,s){return this.dom.setSelectionRange(t,e,s),this}get labels(){return Array.from(this.dom.labels??[]).map(t=>$(t))}}b.mixin(Ut,A.create("checkValidity","reportValidity","autocomplete","name","form","required","disabled","minLength","maxLength","validationMessage","validity","willValidate"));var ht;class zt extends f{constructor(e){super("async",e);z(this,ht,!1)}await(e){return e instanceof Function?e(this).then(s=>this._loaded(s)):e.then(s=>this._loaded(s)),this}_loaded(e){if(D(this,ht,!0),typeof e=="string")this.replace(new J(e));else if(e instanceof I){const s=new J(e.toString());e.use(s,"content"),this.replace(s)}else e==null?this.replace(new J(String(e))):this.replace(e);this.dom.dispatchEvent(new Event("load"))}get loaded(){return M(this,ht)}}ht=new WeakMap;const de=Object.freeze(Object.defineProperty({__proto__:null,$Async:zt},Symbol.toStringTag,{value:"Module"}));class fe extends et{constructor(t,e){super(t,e)}autoplay(t){return $.fluent(this,arguments,()=>this.dom.autoplay,()=>$.set(this.dom,"autoplay",t))}get buffered(){return this.dom.buffered}controls(t){return $.fluent(this,arguments,()=>this.dom.controls,()=>$.set(this.dom,"controls",t))}crossOrigin(t){return $.fluent(this,arguments,()=>this.dom.crossOrigin,()=>$.set(this.dom,"crossOrigin",t))}get currentSrc(){return this.dom.currentSrc}currentTime(t){return $.fluent(this,arguments,()=>this.dom.currentTime,()=>$.set(this.dom,"currentTime",t))}defaultMuted(t){return $.fluent(this,arguments,()=>this.dom.defaultMuted,()=>$.set(this.dom,"defaultMuted",t))}defaultPlaybackRate(t){return $.fluent(this,arguments,()=>this.dom.defaultPlaybackRate,()=>$.set(this.dom,"defaultPlaybackRate",t))}disableRemotePlayback(t){return $.fluent(this,arguments,()=>this.dom.disableRemotePlayback,()=>$.set(this.dom,"disableRemotePlayback",t))}get duration(){return this.dom.duration}get ended(){return this.dom.ended}get error(){return this.dom.error}loop(t){return $.fluent(this,arguments,()=>this.dom.loop,()=>$.set(this.dom,"loop",t))}mediaKeys(t){return $.fluent(this,arguments,()=>this.dom.mediaKeys,()=>$.set(this.dom,"setMediaKeys",[t]))}muted(t){return $.fluent(this,arguments,()=>this.dom.muted,()=>$.set(this.dom,"muted",t))}get networkState(){return this.dom.networkState}get paused(){return this.dom.paused}playbackRate(t){return $.fluent(this,arguments,()=>this.dom.playbackRate,()=>$.set(this.dom,"playbackRate",t))}get played(){return this.dom.played}preload(t){return $.fluent(this,arguments,()=>this.dom.preload,()=>$.set(this.dom,"preload",t))}preservesPitch(t){return $.fluent(this,arguments,()=>this.dom.preservesPitch,()=>$.set(this.dom,"preservesPitch",t))}get readyState(){return this.dom.readyState}get remote(){return this.dom.remote}get seekable(){return this.dom.seekable}get seeking(){return this.dom.seeking}sinkId(t){return $.fluent(this,arguments,()=>this.dom.sinkId,()=>$.set(this.dom,"setSinkId",[t]))}src(t){return $.fluent(this,arguments,()=>this.dom.src,()=>$.set(this.dom,"src",t))}srcObject(t){return $.fluent(this,arguments,()=>this.dom.srcObject,()=>$.set(this.dom,"srcObject",t))}get textTracks(){return this.dom.textTracks}volume(t){return $.fluent(this,arguments,()=>this.dom.volume,()=>$.set(this.dom,"volume",t))}addTextTrack(t,e,s){return this.dom.addTextTrack(t,e,s)}canPlayType(t){return this.dom.canPlayType(t)}fastSeek(t){return this.dom.fastSeek(t),this}load(){return this.dom.load(),this}pause(){return this.dom.pause(),this}async play(){return await this.dom.play(),this}get isPlaying(){return this.currentTime()>0&&!this.paused&&!this.ended&&this.readyState>2}}class pe extends fe{constructor(t){super("video",t)}disablePictureInPicture(t){return $.fluent(this,arguments,()=>this.dom.disablePictureInPicture,()=>$.set(this.dom,"disablePictureInPicture",t))}height(t){return $.fluent(this,arguments,()=>this.dom.height,()=>$.set(this.dom,"height",t))}width(t){return $.fluent(this,arguments,()=>this.dom.width,()=>$.set(this.dom,"width",t))}playsInline(t){return $.fluent(this,arguments,()=>this.dom.playsInline,()=>$.set(this.dom,"playsInline",t))}poster(t){return $.fluent(this,arguments,()=>this.dom.poster,()=>$.set(this.dom,"poster",t))}get videoHeight(){return this.dom.videoHeight}get videoWidth(){return this.dom.videoWidth}cancelVideoFrameCallback(t){return this.dom.cancelVideoFrameCallback(t),this}getVideoPlaybackQuality(){return this.dom.getVideoPlaybackQuality()}requestPictureInPicture(){return this.dom.requestPictureInPicture()}requestVideoFrameCallback(t){return this.dom.requestVideoFrameCallback(t)}}const yt=class yt extends Rt{constructor(){super(...arguments),this.dom=window}};yt.$=new yt;let bt=yt;class me{constructor(t){this.keyMap=new Map,t.on("keydown",e=>{var s;this.conditional&&!this.conditional(e)||(s=this.keyMap.get(e.key))==null||s.keydown.forEach(i=>i(e))}),t.on("keyup",e=>{var s;this.conditional&&!this.conditional(e)||(s=this.keyMap.get(e.key))==null||s.keyup.forEach(i=>i(e))}),t.on("keypress",e=>{var s;this.conditional&&!this.conditional(e)||(s=this.keyMap.get(e.key))==null||s.keypress.forEach(i=>i(e))})}if(t){return this.conditional=t,this}assigns(t,e,s){t=b.orArrayResolve(t),e=b.orArrayResolve(e);for(const i of t){const n=this.keyMap.get(i)??{keydown:new Set,keypress:new Set,keyup:new Set};for(const o of e)n[o].add(s);this.keyMap.set(i,n)}return this}unassign(t,e,s){t=b.orArrayResolve(t),e=e?b.orArrayResolve(e):["keydown","keypress","keyup"];for(const i of t){const n=this.keyMap.get(i)??{keydown:new Set,keypress:new Set,keyup:new Set};for(const o of e)s?n[o].delete(s):n[o].clear();this.keyMap.set(i,n)}return this}keydown(t,e){return this.assigns(t,"keydown",e),this}keyup(t,e){return this.assigns(t,"keyup",e),this}keypress(t,e){return this.assigns(t,"keypress",e),this}self(t){return t(this),this}}class ge extends Q{constructor(t,e){super(t,e)}}function $e(r){if(r.$)return r.$;if(r.nodeName.toLowerCase()==="body")return new f("body",{dom:r});if(r.nodeName.toLowerCase()==="head")return new f("head",{dom:r});if(r.nodeName.toLowerCase()==="#document")return at.from(r);if(r instanceof HTMLElement){const t=$.TagNameElementMap[r.tagName.toLowerCase()],e=t?t===f?new t(r.tagName,{dom:r}):new t({dom:r}):new f(r.tagName,{dom:r});if(e instanceof f)for(const s of Array.from(e.dom.childNodes))e.children.add($(s));return e}else if(r instanceof Text){const t=new J(r.textContent??"");return t.dom=r,t}else if(r instanceof SVGElement&&r.tagName.toLowerCase()==="svg")return new ge("svg",{dom:r});throw`$NODE.FROM: NOT SUPPORT TARGET ELEMENT TYPE (${r.nodeName})`}function S(r){if(typeof r>"u"||r===null||r instanceof st)return r;if(typeof r=="string"){if(r.startsWith("::"))return Array.from(document.querySelectorAll(r.replace(/^::/,""))).map(t=>S(t));if(r.startsWith(":"))return S(document.querySelector(r.replace(/^:/,"")));if(r in S.TagNameElementMap){const t=S.TagNameElementMap[r];return t===et?new et(r):t===f?new f(r):new t}else return new f(r)}if(r instanceof Node)return r.$?r.$:$e(r);if(r instanceof Window)return bt.$;throw`$: NOT SUPPORT TARGET ELEMENT TYPE ('${r}')`}(r=>{r.anchorHandler=null,r.TagNameElementMap={html:f,head:f,document:at,body:f,a:Ht,p:f,pre:f,code:f,blockquote:f,strong:f,h1:f,h2:f,h3:f,h4:f,h5:f,h6:f,div:f,ol:f,ul:f,dl:f,li:f,input:k,label:Ft,button:Ot,form:Nt,img:le,dialog:ue,canvas:ce,select:Vt,option:jt,optgroup:Wt,textarea:Ut,video:pe,async:zt};function t(m,w,x,E){return w.length?(E(),m):x()}r.fluent=t;function e(m,w,x,E){if(x!==void 0){if(x instanceof I){x.use(m,w),m[w]instanceof Function?m[w](...x.value):x.value!==void 0&&(m[w]=x.value),E&&E(x);return}m[w]instanceof Function?m[w](...x):m[w]=x}}r.set=e;function s(m,w){return I.create(m,w)}r.state=s;async function i(m,w){return new Promise(x=>{const E=new FileReader;E.onload=W=>{const N=r("img");if(N.once("load",ut=>{const G=r("canvas"),P=G.getContext("2d"),U=N.height()/N.width(),[it,rt]=[U>1?w/U:w,U>1?w:w*U];G.height(rt).width(it),P==null||P.drawImage(N.dom,0,0,it,rt),x(G.toDataURL(m.type))}),!W.target)throw"$.resize(): e.target is null";N.src(W.target.result)},E.readAsDataURL(m)})}r.resize=i;function n(m){const w=new DOMParser().parseFromString(m,"text/html").body;return Array.from(w.children).map(x=>r(x))}r.html=n;function o(m,w){return Object.assign(r.TagNameElementMap,{[m]:w}),r.TagNameElementMap}r.registerTagName=o;function a(m){return m instanceof Array?m:[m]}r.orArrayResolve=a;function h(m,w){return b.mixin(m,w)}r.mixin=h;function u(m=1){return parseInt(getComputedStyle(document.documentElement).fontSize)*m}r.rem=u;function d(m){return m()}r.call=d;function c(){return new C}r.events=c;function p(m){return new Gt(m)}r.pointers=p;function g(m){return new me(m)}r.keys=g;function _(){return new ve}r.focus=_;function T(...m){return b.classlist(m)}r.classlist=T})(S);globalThis.$=S;class ve extends C{constructor(){super(),this.layerMap=new Map,this.historyList=[]}layer(t){const e=this.layerMap.get(t)??new ye(t).on("blur",s=>this.fire("blur",s)).on("focus",s=>this.fire("focus",s));return this.layerMap.set(e.id,e),e}next(){return this.select(0)}prev(){return this.select(1)}up(){return this.select(2)}down(){return this.select(3)}right(){return this.select(4)}left(){return this.select(5)}blur(){var t;return(t=this.currentLayer)==null||t.blur(),this}select(t){var n;if(this.currentLayer=this.currentLayer??[...this.layerMap.values()].at(0),!this.currentLayer)return this;const e=this.currentLayer.currentFocus,s=this.currentLayer.elementSet.array;if(!e){const o=this.currentLayer.beforeBlur??s.at(0);return o?(this.currentLayer.focus(o),this):this}const i=s.indexOf(e);switch(t){case 0:case 1:{let o=t===0?i+1:i-1;(o===s.length&&this.currentLayer.loop()||o===-1&&!this.currentLayer.loop())&&(o=0);const a=s.at(o);if(!a)break;this.currentLayer.focus(a);break}case 3:case 5:case 4:case 2:{const o=e.coordinate();if(!o)break;const a=$.call(()=>{switch(t){case 2:return{y:o.y,x:o.x/2};case 3:return{y:o.y+o.height,x:o.x/2};case 5:return{y:o.y/2,x:o.x};case 4:return{y:o.y/2,x:o.x+o.width}}}),u=(n=s.map(d=>{if(d===e)return;const c=d.coordinate();if(!c)return;const p=$.call(()=>{switch(t){case 2:return{y:c.y+c.height,x:c.x/2};case 3:return{y:c.y,x:c.x/2};case 5:return{y:c.y/2,x:c.x+c.width};case 4:return{y:c.y/2,x:c.x}}});return{$ele:d,elePosition:c,distance:Math.sqrt((p.x-a.x)**2+(p.y-a.y)**2)}}).detype(void 0).filter(({elePosition:d})=>{switch(t){case 2:if(d.y+d.height>=o.y)return!1;break;case 3:if(d.y<=o.y+o.height)return!1;break;case 5:if(d.x+d.width>=o.x)return!1;break;case 4:if(d.x<=o.x+o.width)return!1;break}return!0}).sort((d,c)=>d.distance-c.distance).at(0))==null?void 0:n.$ele;if(!u)break;this.currentLayer.focus(u)}}return this}}class ye extends C{constructor(t){super(),this.elementSet=new Set,this.entrySet=new Set,this.focusHandler=(e,s)=>this.focus(s,!0),this.blurHandler=(e,s)=>this.blur(s),this.__$property__={loop:!0,scrollThreshold:0},this.id=t,this.add=this.add.bind(this),this.entry=this.entry.bind(this)}add(t){return $.orArrayResolve(t).forEach(e=>{this.elementSet.has(e)||(this.elementSet.add(e),e.tabIndex(0))}),this}remove(t){return this.currentFocus===t&&this.blur(),this.beforeBlur===t&&(this.beforeBlur=void 0),this.elementSet.delete(t),this}entry(t){return $.orArrayResolve(t).forEach(this.entrySet.add.bind(this.entrySet)),this}focus(t,e=!1){if(!t)return this;t.hide(!1);const{scrollTop:s,scrollLeft:i}=document.documentElement,n=$.call(()=>{const h=t.domRect();return{left:h.left+i,top:h.top+s,right:h.right+i,bottom:h.bottom+s,height:h.height,width:h.width}}),{scrollThreshold:o}=this.__$property__,a=this.currentFocus;return this.blur(),this.currentFocus=t,(s>n.top-o||s>n.bottom+o)&&document.documentElement.scrollTo({left:n.left-o,top:n.top-o}),(s+innerHeight<n.top+o||s+innerHeight<n.bottom+o)&&document.documentElement.scrollTo({left:n.left-o,top:n.bottom-innerHeight+o}),t.attribute("focus",""),this.fire("focus",{$prevFocus:a,$focused:t,layer:this}),e||t.trigger("focus"),this}blur(t){return t&&t!==this.currentFocus?this:this.currentFocus?(this.beforeBlur=this.currentFocus,this.currentFocus.attribute("focus",null),this.currentFocus=void 0,this.fire("blur",{$prevFocus:this.beforeBlur,layer:this}),this.beforeBlur.trigger("blur"),this):this}removeAll(){return this.elementSet.forEach(t=>this.remove(t)),this}loop(t){return $.fluent(this,arguments,()=>this.__$property__.loop,()=>$.set(this.__$property__,"loop",t))}scrollThreshold(t){return $.fluent(this,arguments,()=>this.__$property__.scrollThreshold,()=>$.set(this.__$property__,"scrollThreshold",t))}}class Gt extends C{constructor(t){super(),this.map=new Map,this.$node=t,this.$node.on("pointerdown",e=>this.down(e)),this.$node.on("pointerup",e=>this.up(e)),this.$node.on("pointermove",e=>this.move(e)),this.$node.on("pointercancel",e=>this.cancel(e))}down(t){const e=new we(this,this.toData(t),$(t.target));this.map.set(e.id,e),this.fire("down",e,t)}up(t){const e=this.map.get(t.pointerId);e&&(this.map.delete(t.pointerId),this.fire("up",e,t))}move(t){const e=this.map.get(t.pointerId);e&&(this.map.set(e.id,e),e.update(this.toData(t)),e.direction||(e.move_x>5||e.move_x<-5?e.direction=0:(e.move_y>5||e.move_y<-5)&&(e.direction=1)),this.fire("move",e,t))}cancel(t){const e=this.map.get(t.pointerId);e&&(e.update(this.toData(t)),this.map.delete(e.id),this.fire("cancel",e,t))}toData(t){return{id:t.pointerId,type:t.pointerType,width:t.width,height:t.height,x:t.x,y:t.y}}}class we{constructor(t,e,s){this.movement_x=0,this.movement_y=0,this.direction=null,Object.assign(this,e),this.manager=t,this.$target=s,this.initial_x=e.x,this.initial_y=e.y}get move_x(){return this.x-this.initial_x}get move_y(){return this.y-this.initial_y}update(t){const e=this.move_x,s=this.move_y;return Object.assign(this,t),this.movement_x=this.move_x-e,this.movement_y=this.move_y-s,this}delete(){return this.manager.map.delete(this.id),this}}var Bt=(r=>(r[r.Horizontal=0]="Horizontal",r[r.Vertical=1]="Vertical",r))(Bt||{});Array.prototype.detype=function(...r){return this.filter(t=>{if(r.length)for(const e of r)return typeof t!=typeof e;else return t!==void 0})};Object.defineProperties(Set.prototype,{array:{configurable:!0,get:function(){return Array.from(this)}}});Set.prototype.sort=function(r){return this.array.sort(r)};class Kt extends f{constructor(t){super("layout",t),this._property={ROW_MAX_HEIGHT:200,GAP:0,IS_RENDERING:!1,RENDER_REQUEST:!1,COLUNM:1,TYPE:"justified",ROOT:null,ITEM_PROPERTIES:new Map},this.css({display:"block",position:"relative"}),new ResizeObserver(e=>{this.inDOM()&&(this.render(),this.dom.dispatchEvent(new Event("resize")))}).observe(this.dom),document.addEventListener("scroll",e=>{e.target===this.root().dom&&this.scrollCompute()},{passive:!0}),new IntersectionObserver(e=>{this.inDOM()&&this.render()}).observe(this.dom)}type(t){return $.fluent(this,arguments,()=>this._property.TYPE,()=>$.set(this._property,"TYPE",t))}maxHeight(t){return $.fluent(this,arguments,()=>this._property.ROW_MAX_HEIGHT,()=>$.set(this._property,"ROW_MAX_HEIGHT",t))}column(t){return $.fluent(this,arguments,()=>this._property.COLUNM,()=>$.set(this._property,"COLUNM",t))}gap(t){return $.fluent(this,arguments,()=>this._property.GAP,()=>$.set(this._property,"GAP",t))}root(t){return $.fluent(this,arguments,()=>this._property.ROOT??$(document),()=>$.set(this._property,"ROOT",t))}get COL_WIDTH(){return(this.offsetWidth-this._property.GAP*(this._property.COLUNM-1))/this._property.COLUNM}justifiedCompute(){const t=[],e=this.offsetWidth;for(const s of this.children.array){const i=$(s);if(!(i instanceof Q))continue;const n=i.attribute("layout-item-ratio"),o=n?parseFloat(n):i.dom.offsetWidth/i.dom.offsetHeight,a={$node:i,ratio:o};let h=t.at(-1);(!h||h.height<this._property.ROW_MAX_HEIGHT)&&(h={height:0,items:[],ratio:0},t.push(h));let u=0;h.items.forEach(p=>u+=p.ratio);const d=u+o,c=(e-this._property.GAP*h.items.length)/d;h.items.push(a),h.ratio=d,h.height=c}return t}waterfallCompute(){const t=[],e=this.COL_WIDTH,s=()=>{if(t.length<this._property.COLUNM){const i={items:[],ratio:0,height:0};return t.push(i),i}return[...t].sort((i,n)=>i.height-n.height)[0]};for(const i of this.children.array){const n=$(i);if(!(n instanceof Q))continue;const o=n.attribute("layout-item-ratio"),a=o?parseFloat(o):n.dom.offsetWidth/n.dom.offsetHeight,h={$node:n,ratio:a},u=s();let d=0;u.items.forEach(g=>d+=g.ratio);const c=e/(u.height+e/a),p=e/c;u.items.push(h),u.ratio=c,u.height=p}return t}render(){if(!this.inDOM())return this;if(this.events.fire("beforeRender"),this._property.ITEM_PROPERTIES.clear(),this._property.TYPE==="justified"){const t=this.justifiedCompute();let e=0;for(const s of t){let i=0;s.height>this._property.ROW_MAX_HEIGHT&&(s.height=this._property.ROW_MAX_HEIGHT);for(const n of s.items){const o=n.ratio*s.height;n.$node.css({position:"absolute",height:`${s.height}px`,width:`${o}px`,top:`${e}px`,left:`${i}px`}),n.$node.attribute("layout-item-ratio",n.ratio),this._property.ITEM_PROPERTIES.set(n.$node,{height:s.height,width:o,top:e,left:i,ratio:n.ratio,$node:n.$node}),n.$node.coordinate({x:i,y:e,height:s.height,width:o}),i+=s.height*n.ratio+this._property.GAP}e+=s.height+this._property.GAP}this.css({height:`${e}px`})}else if(this._property.TYPE="waterfall"){const t=this.waterfallCompute(),e=this.COL_WIDTH;let s=0;for(const i of t){let n=0;for(const o of i.items){const a=e/o.ratio;o.$node.css({position:"absolute",height:`${a}px`,width:`${e}px`,top:`${n}px`,left:`${s}px`}),o.$node.attribute("layout-item-ratio",o.ratio),this._property.ITEM_PROPERTIES.set(o.$node,{height:a,width:e,top:n,left:s,ratio:o.ratio,$node:o.$node}),o.$node.coordinate({x:s,y:n,height:a,width:e}),n+=a+this._property.GAP}s+=e+this._property.GAP}if(t.length){const i=t.sort((n,o)=>o.height-n.height)[0];this.css({height:`${i.height+i.items.length*this._property.GAP}px`})}else this.css({height:""})}return this.scrollCompute(),this.events.fire("afterRender"),this}scrollCompute(){if(this.inDOM()===!1)return;const t=document.documentElement.scrollTop-this.dom.offsetTop;this._property.ITEM_PROPERTIES.forEach((e,s)=>{const i=e.top,n=e.top+e.height;s.attribute("focus")===""||document.activeElement===s.dom||(n>t&&i<t+innerHeight+e.height?s.hide(!1,!1):s.hide(!0,!1))}),this.children.render()}}$.registerTagName("layout",Kt);class qt extends f{constructor(t){super("view",t),this.viewCache=new Map,this.contentId=null}setView(t,e){return this.viewCache.set(t,e),this}deleteView(t){return this.viewCache.delete(t),this}deleteAllView(){return this.viewCache.clear(),this}switchView(t){if(t===this.contentId)return this;const e=this.viewCache.get(t);if(e===void 0)return this;const s=this.currentContent;let i=!1;this.contentId=t;const n=()=>{this.events.fire("rendered",{$view:this,previousContent:s,nextContent:e})},o=()=>{this.events.fire("afterSwitch",{$view:this,previousId:t})};return this.events.fire("beforeSwitch",{$view:this,preventDefault:()=>i=!0,targetId:t,previousContent:s,nextContent:e,switched:o,rendered:n}),i||(this.content(e),n(),o()),this}get currentContent(){if(this.contentId)return this.viewCache.get(this.contentId)}}$.registerTagName("view",qt);var F;const y=class y extends qt{constructor(e){super({tagname:"router",...e});z(this,F);D(this,F,""),this.routes=new Map,y.routers.add(this)}base(e){return $.fluent(this,arguments,()=>M(this,F),()=>{D(this,F,e??M(this,F))})}map(e){e=$.orArrayResolve(e);for(const s of e)s instanceof Array?this.map(s):this.routes.set(s.path(),s);return this.resolve(),this}resolve(){return new Promise(e=>{var _;if(!location.pathname.startsWith(M(this,F)))return e(2);const s=location.pathname.replace(M(this,F),"/").replace("//","/"),i=s.split("/").map(T=>`/${T}`),n=location.search,o=new Map(n.replace("?","").split("&").map(T=>T.split("="))),h=(()=>{const T=[];for(const[m,w]of this.routes){const x=$.orArrayResolve(m);for(const E of x){let W=0,N={},ut={};const G=E.split("/").map(P=>`/${P}`);if(!(i.length<G.length)){for(let P=0;P<G.length;P++){const[U,it]=G[P].split("?");if(it&&it.split("&").forEach(rt=>{const kt=o.get(rt);kt!==void 0&&W++,Object.assign(ut,{[rt]:kt})}),U.startsWith("/:")){W++,Object.assign(N,{[U.replace("/:","")]:i[P].replace("/","")});continue}else if(E.startsWith("#")&&E===location.hash){W++;continue}else if(U===i[P]){W++;continue}else break}T.push({deep:W,$route:w,params:N,query:ut,routePath:E,pathId:w.static()?Object.keys(ut).length!==0?s+n:Object.keys(N).length!==0?s:x[0]:x[0]})}}}return T.sort((m,w)=>w.deep-m.deep).at(0)})();if(!h)return e(1);const{$route:u,params:d,pathId:c,query:p}=h;if(u.static()&&c===this.contentId)return e(0);this.events.once("rendered",({nextContent:T,previousContent:m})=>{m==null||m.events.fire("afterShift",{$page:m}),T.events.fire("rendered",{$page:T,params:d,query:p}),e(0)});const g=this.viewCache.get(c)??u.build({params:d,query:p});this.viewCache.has(c)||this.setView(c,g),this.events.once("beforeSwitch",()=>{var T;g.events.fire("beforeShift",{$page:g}),(T=this.currentContent)==null||T.events.fire("beforeShift",{$page:this.currentContent})}),this.events.once("afterSwitch",()=>g.events.fire("afterShift",{$page:g})),(_=this.currentContent)==null||_.events.fire("close",{$page:this.currentContent}),g.events.fire("open",{$page:g,params:d,query:p}),this.switchView(c)})}static init(){if(!history.state||!("index"in history.state)){const e={index:y.index};history.replaceState(e,"")}else y.index=history.state.index;return y.navigationDirection=0,y.resolve(),window.addEventListener("popstate",()=>y.popstate()),window.addEventListener("scroll",()=>{this.setScrollHistory(this.index,location.href,document.documentElement.scrollTop)},{passive:!0}),history.scrollRestoration="manual",this}static open(e,s){return e===void 0?this:(e=this.urlResolver(e),e.href===this.url.href?this:e.origin!==this.url.origin?(window.open(e,s),this):(y.clearForwardScrollHistory(),y.forwardIndex=0,y.index++,history.pushState(y.historyState,"",e),y.stateChange(0),y.resolve(),this))}static back(){return history.back(),this}static forward(){return this.forwardIndex===0?this:(history.forward(),this)}static replace(e){return e===void 0?this:(e=this.urlResolver(e),history.replaceState(y.historyState,"",e),this.stateChange(2),this.setScrollHistory(this.index,location.href,0),y.resolve(),this)}static urlResolver(e){return e instanceof URL?e:(e.startsWith("/")&&(e=`${location.origin}${e}`),e.startsWith("#")&&(e=`${location.origin}${location.pathname}${e}`),new URL(e))}static popstate(){const e=history.state.index>y.index?0:history.state.index<y.index?1:2;e===0?this.forwardIndex--:e===1&&this.forwardIndex++,y.index=history.state.index,y.stateChange(e),y.resolve()}static async resolve(){await Promise.all([...y.routers.values()].map(e=>e.resolve())),this.scrollRestoration(),this.setScrollHistory(this.index,location.href,document.documentElement.scrollTop)}static get historyState(){return{index:y.index}}static stateChange(e){const s=this.url,i=new URL(location.href);this.url=i,y.events.fire("stateChange",{beforeURL:s,afterURL:i,direction:e}),y.navigationDirection=e}static setScrollHistory(e,s,i){const n=this.getScrollHistory();if(!n)return sessionStorage.setItem(this.scrollHistoryKey,JSON.stringify({[e]:{url:s,value:i}}));n[e]={url:s,value:i},sessionStorage.setItem(this.scrollHistoryKey,JSON.stringify(n))}static getScrollHistory(){const e=sessionStorage.getItem(this.scrollHistoryKey);if(e)return JSON.parse(e)}static clearForwardScrollHistory(){const e=this.getScrollHistory();if(e)for(const s in e)Number(s)>this.index&&delete e[s],sessionStorage.setItem(this.scrollHistoryKey,JSON.stringify(e))}static scrollRestoration(){const e=this.getScrollHistory();if(e&&e[this.index])document.documentElement.scrollTop=e[this.index].value??0;else if(location.hash.length){const s=$(document.body).$(`:${location.hash}`);s&&(document.documentElement.scrollTop=s.dom.offsetTop)}else document.documentElement.scrollTop=0}};F=new WeakMap,y.routers=new Set,y.events=new C,y.index=0,y.forwardIndex=0,y.url=new URL(location.href),y.scrollHistoryKey="$ROUTER_SCROLL_HISTORY";let O=y;var B=(r=>(r[r.Forward=0]="Forward",r[r.Back=1]="Back",r[r.Replace=2]="Replace",r))(B||{});O.init();class be extends f{constructor(t){super("page"),this.rendered=!1,this.$route=t}render(t){const e=this.$route.builder();return e&&e({$page:this,params:t.params,query:t.query}),this.rendered=!0,this}}var q,lt;class _e extends f{constructor(e){super("route",e);z(this,q);z(this,lt);D(this,q,""),this.rendered=!1,this.__$property__.static=!0}path(e){return $.fluent(this,arguments,()=>M(this,q),()=>D(this,q,e??M(this,q)))}static(e){return $.fluent(this,arguments,()=>this.__$property__.static,()=>$.set(this.__$property__,"static",e))}builder(e){return arguments.length?(D(this,lt,e),this):M(this,lt)}build(e){return new be(this).render({params:e.params,query:e.query})}}q=new WeakMap,lt=new WeakMap;class Xt extends Ht{constructor(t){super(t),Object.assign(this.__$property__,{preventDefault:!1}),this.on("click",e=>{e.preventDefault(),this.__$property__.preventDefault||$.open(this.href(),this.target())})}preventDefault(t){return $.fluent(this,arguments,()=>this.__$property__.preventDefault,()=>$.set(this.__$property__,"preventDefault",t))}}$.registerTagName("router",O);$.registerTagName("route",_e);$.registerTagName("router-a",Xt);Object.assign($,{open(r,t){return O.open(r,t)},replace(r){return O.replace(r)},back(){return O.back()},forward(){return O.forward()}});class xe{constructor(t,e){l(this,"booru");Object.assign(this,e),this.booru=t}static async fetchUserFavorites(t,e,s,i=100,n){return(await t.fetch(`/favorites.json?${s}&${`search[user_id]=${e.id}`}&limit=${i}&page=${n}`)).map(a=>(e.favorites.add(a.post_id),a.post_id))}update(t){return Object.assign(this,t),this}}class _t{constructor(t,e,s=!0){l(this,"name$",$.state("..."));l(this,"post_upload_count$",$.state(0));l(this,"level$",$.state(10));l(this,"level_string$",$.state("..."));l(this,"booru");l(this,"favorites",new Set);this.booru=t,Object.assign(this,e),s&&this.update$()}static async fetch(t,e){var n;let s;if(typeof e=="string"){const o=(await t.fetch(`/users.json?search[name]=${e}`)).at(0);if(!o)throw"User Not Found";return s=o}else s=await t.fetch(`/users/${e}.json`);const i=((n=t.users.get(s.id))==null?void 0:n.update(s))??new this(t,s);return t.users.set(i.id,i),i}static async fetchMultiple(t,e,s=200){let i="";if(e)for(const[a,h]of Object.entries(e))if(h instanceof Array)i+=`&search[${a}]=${h}`;else if(h instanceof Object)for(const[u,d]of Object.entries(h))i+=`&search[${a}${u}]=${d}`;else i+=`&search[${a}]=${h}`;return(await t.fetch(`/users.json?limit=${s}${i}`)).map(a=>{const h=new this(t,a);return t.users.set(h.id,h),h})}update(t){return Object.assign(this,t),this.update$(),this}update$(){this.name$.set(this.name),this.post_upload_count$.set(this.post_upload_count),this.level$.set(this.level),this.level_string$.set(this.level_string)}get booruURL(){return`${this.booru.origin}/users/${this.id}`}get url(){return`/users/${this.id}`}}const wt=class wt extends _t{constructor(e,s,i){super(e,i,!1);l(this,"apiKey");l(this,"favorite_count$",$.state(0));l(this,"forum_post_count$",$.state(0));this.apiKey=s,this.update$()}update$(){var e,s;super.update$(),(e=this.forum_post_count$)==null||e.set(this.forum_post_count),(s=this.favorite_count$)==null||s.set(this.favorite_count)}async init(){await this.fetchFavorites()}async fetchFavorites(){const e=Array.from(this.favorites.keys()).at(-1),s=await xe.fetchUserFavorites(this.booru,this,"",1e3,e?`b${e}`:1);return wt.events.fire("favoriteUpdate",this),s.length>=1e3&&this.fetchFavorites(),s}static get storageUserData(){const e=localStorage.getItem("user_data");return e?JSON.parse(e):null}static set storageUserData(e){localStorage.setItem("user_data",JSON.stringify(e))}};l(wt,"events",new C);let V=wt;const H=class H{constructor(t){l(this,"user");l(this,"posts",new Map);l(this,"tags",new Map);l(this,"users",new Map);l(this,"favorites",new Map);Object.assign(this,t),this.origin.endsWith("/")&&(this.origin=this.origin.slice(0,-1)),H.manager.set(this.name,this)}static set(t){this.used=t,this.name$.set(t.name),this.storageAPI=t.name;const e=V.storageUserData;return e&&t.login(e.username,e.apiKey),this.events.fire("set"),this}static get storageAPI(){return localStorage.getItem("booru_api")}static set storageAPI(t){t?localStorage.setItem("booru_api",t):localStorage.removeItem("booru_api")}async fetch(t,e="GET"){const s=this.user?`${t.includes("?")?"&":"?"}login=${this.user.name}&api_key=${this.user.apiKey}`:"",i=await fetch(`${this.origin}${t}${s}`,{method:e}).then(n=>n.json());if(i.success===!1)throw i.message;return i}async login(t,e){const s=await this.fetch(`/profile.json?login=${t}&api_key=${e}`);return this.user=new V(this,e,s),this.user.init(),H.events.fire("login",this.user),this.user}logout(){return this.user=void 0,V.storageUserData=null,H.events.fire("logout"),this}};l(H,"used"),l(H,"events",new C),l(H,"name$",$.state(H.name)),l(H,"manager",new Map);let v=H;class At{constructor(t,e){l(this,"post_count$",$.state(0));l(this,"name$",$.state(""));l(this,"booru");this.booru=t,Object.assign(this,e),this.$update()}static async fetch(t,e){var n;const s=await t.fetch(`/tags/${e}.json`),i=((n=t.tags.get(s.id))==null?void 0:n.update(s))??new this(t,s);return t.tags.set(i.id,i),i}static async fetchMultiple(t,e,s=1e3){let i="";if(e)for(const[a,h]of Object.entries(e))if(h instanceof Array)i+=`&search[${a}]=${h}`;else if(h instanceof Object)for(const[u,d]of Object.entries(h))i+=`&search[${a}${u}]=${d}`;else i+=`&search[${a}]=${h}`;return(await t.fetch(`/tags.json?limit=${s}${i}`)).map(a=>{var u;const h=((u=t.tags.get(a.id))==null?void 0:u.update(a))??new this(t,a);return t.tags.set(h.id,h),h})}static get(t,e){return[...t.tags.values()].find(s=>s.name===e)}update(t){return Object.assign(this,t),this.$update(),this}$update(){this.post_count$.set(this.post_count),this.name$.set(this.name)}}var K=(r=>(r[r.General=0]="General",r[r.Artist=1]="Artist",r[r.Copyright=3]="Copyright",r[r.Character=4]="Character",r[r.Meta=5]="Meta",r))(K||{});const Mt=1e3,pt=Mt*60,mt=pt*60,gt=mt*24,Se=gt*7,dt=new Intl.RelativeTimeFormat("en",{style:"long"});function xt(r){r=Math.floor(r);const t=r/Mt,e=r/pt,s=r/mt,i=r/gt,n=r%1e3,o=Math.floor(r%6e4/1e3),a=Math.floor(r%36e5/6e4),h=Math.floor(r%(36e5*24)/36e5),u=o.toString().padStart(2,"0"),d=a.toString().padStart(2,"0"),c=h.toString().padStart(2,"0");return{seconds:t,minutes:e,hours:s,days:i,mil:n,s:o,min:a,h,ss:u,mm:d,hh:c}}function Te(r,t=Date.now()){const e=r-t,s=Math.abs(e);if(s<pt)return dt.format(Math.round(e/Mt),"second");if(s<mt)return dt.format(Math.round(e/pt),"minute");if(s<gt)return dt.format(Math.round(e/mt),"hour");if(s<Se)return dt.format(Math.round(e/gt),"day");const i=new Date(r);return`${i.getFullYear()}-${(i.getMonth()+1).toString().padStart(2,"0")}-${i.getDate().toString().padStart(2,"0")}`}function Ie(r){if(r<1e3)return`${r}B`;const t=r/1e3;if(t<1e3)return`${t.toFixed(2)}kB`;const e=r/1e3**2;if(e<1e3)return`${e.toFixed(2)}MB`;const s=r/1e3**3;if(s<1e3)return`${s.toFixed(2)}GB`;const i=r/1e3**4;if(i<1e3)return`${i.toFixed(2)}TB`;const n=r/1e3**5;return n<1e3?`${n.toFixed(2)}PB`:`${(r/(1e3*6)).toFixed(2)}EB`}const Oe=new Intl.NumberFormat("en",{notation:"compact"});function nt(r){return Oe.format(r)}const R="...";class Y extends C{constructor(e,s,i){super();l(this,"uploader$",S.state(R));l(this,"approver$",S.state(R));l(this,"created_date$",S.state(R));l(this,"favcount$",S.state(0));l(this,"score$",S.state(0));l(this,"file_size$",S.state(R));l(this,"file_ext$",S.state(R));l(this,"file_url$",S.state(R));l(this,"source$",S.state(R));l(this,"dimension$",S.state(R));l(this,"booruUrl$",S.state(R));l(this,"createdDate",new Date(this.created_at));l(this,"ready");l(this,"webm_url$",S.state(R));l(this,"booru");this.booru=e,this.id=s,e.posts.set(this.id,this),i?this.update(i):this.ready=this.fetch()}static get(e,s){return e.posts.get(s)??new Y(e,s)}async fetch(){const e=await this.booru.fetch(`/posts/${this.id}.json`);return this.update(e),_t.fetchMultiple(this.booru,{id:[this.uploader_id,this.approver_id].detype(null)}).then(()=>this.update$()),this}static async fetchMultiple(e,s,i=20,n){let o="";if(s){if(typeof s=="string")o=s;else for(const[c,p]of Object.entries(s))if(p!==void 0){if(c==="tags"){o+=`${p}`;continue}o.at(-1)!=="="&&(o+=" "),o+=`${c}:${p}`}}const a=await e.fetch(`/posts.json?limit=${i}&tags=${o}${n?`&page=${n}`:""}&_method=get`);if(!(a instanceof Array))return[];const h=new Set,u=a.map(c=>{var g;const p=((g=e.posts.get(c.id))==null?void 0:g.update(c))??new this(e,c.id,c);return e.posts.set(p.id,p),p.tag_string.split(" ").forEach(_=>h.add(_)),p});if(!u.length)return u;const d=[...new Set(a.map(c=>[c.approver_id,c.uploader_id].detype(null)).flat())];return _t.fetchMultiple(e,{id:d}).then(()=>u.forEach(c=>c.update$())),u}update$(){var e,s,i,n;this.uploader$.set(((e=this.uploader)==null?void 0:e.name$)??((s=this.uploader_id)==null?void 0:s.toString())),this.approver$.set(((i=this.approver)==null?void 0:i.name$)??((n=this.approver_id)==null?void 0:n.toString())??"None"),this.created_date$.set(Te(+new Date(this.created_at))),this.favcount$.set(this.fav_count),this.score$.set(this.score),this.file_size$.set(Ie(this.file_size)),this.file_ext$.set(this.file_ext),this.file_url$.set(this.file_url),this.source$.set(this.source),this.dimension$.set(`${this.image_width}x${this.image_height}`),this.booruUrl$.set(`${this.booruUrl}`),this.isUgoria&&this.webm_url$.set(this.large_file_url),this.createdDate=new Date(this.created_at),this.fire("update")}update(e){return Object.assign(this,e),this.update$(),this}async fetchTags(){await this.ready;const e=this.tag_string.split(" ").filter(s=>!At.get(this.booru,s));return e.length?(await At.fetchMultiple(this.booru,{name:{_space:e.toString().replaceAll(","," ")}}),this):this}async createFavorite(){if(!this.booru.user)return;const e=await this.booru.fetch(`/favorites.json?post_id=${this.id}`,"POST");return this.update(e),this.booru.user.favorites.add(e.id),this.booru.user.favorite_count+=1,this.booru.user.update$(),V.events.fire("favoriteUpdate",this.booru.user),e.id}async deleteFavorite(){!this.booru.user||await fetch(`/api/favorites/${this.id}?login=${this.booru.user.name}&api_key=${this.booru.user.apiKey}&origin=${this.booru.origin}`,{method:"DELETE"}).then(s=>s.json())===!1||(this.fav_count--,this.favcount$.set(this.fav_count),this.booru.user.favorites.delete(this.id),this.booru.user.favorite_count-=1,this.booru.user.update$(),V.events.fire("favoriteUpdate",this.booru.user))}get pathname(){return`/posts/${this.id}`}get uploader(){return this.booru.users.get(this.uploader_id)}get approver(){return this.approver_id?this.booru.users.get(this.approver_id):null}get isVideo(){return this.file_ext==="mp4"||this.file_ext==="webm"||this.file_ext==="zip"}get isGif(){return this.file_ext==="gif"}get isUgoria(){return this.file_ext==="zip"}get hasSound(){return this.tag_string_meta.includes("sound")}get tags(){const e=this.tag_string.split(" ");return[...this.booru.tags.values()].filter(s=>e.includes(s.name))}get previewURL(){var e,s,i;return((i=(s=(e=this.media_asset)==null?void 0:e.variants)==null?void 0:s.find(n=>n.file_ext==="webp"))==null?void 0:i.url)??this.large_file_url}get booruUrl(){return`${this.booru.origin}/posts/${this.id}`}get url(){return`https://danbooru.defaultkavy.com/posts/${this.id}`}get isFileSource(){return this.source.startsWith("file://")}get isLargeFile(){return this.file_size>5e6}}class Qt{constructor(t){Object.assign(this,t)}static async fetch(t,e){const s=await t.fetch(`/artist_commentaries/${e}.json`);return new this(s)}static async fetchMultiple(t,e,s=200){let i="";if(e)for(const[a,h]of Object.entries(e))if(h instanceof Array)i+=`&search[${a}]=${h}`;else if(h instanceof Object)for(const[u,d]of Object.entries(h))i+=`&search[${a}${u}]=${d}`;else i+=`&search[${a}]=${h}`;return(await t.fetch(`/artist_commentaries.json?limit=${s}${i}`)).map(a=>{const h=new this(a);return this.manager.set(h.id,h),h})}}l(Qt,"manager",new Map);class Jt extends f{constructor(e){super("detail-panel");l(this,"post",null);l(this,"options");this.options={preview:(e==null?void 0:e.preview)??!1,tagsType:(e==null?void 0:e.tagsType)??"detail"},this.build()}build(){this.post?this.content([this.options.preview?$("div").class("preview").content([$("img").src(this.post.previewURL)]):null,$("div").class("detail").content([$("section").class("post-info").content([new L("id").name("Post").content(`#${this.post.id}`),new L("uploader").name("Uploader").content(this.post.uploader$),new L("approver").name("Approver").content(this.post.approver$),new L("date").name("Date").content(this.post.created_date$),new L("size").name("Size").content([this.post.file_size$,this.post.dimension$]),new L("file-type").name("File Type").content(this.post.file_ext$),$("div").class("inline").content([new L("favorites").name("Favorites").content(this.post.favcount$),new L("score").name("Score").content(this.post.score$)]),this.post.file_url?new L("file-url").name("File").content([$("a").href(this.post.file_url$).content(this.post.file_url$.convert(e=>e?e.replace("https://",""):"")).target("_blank"),$("ion-icon").name("clipboard").on("click",(e,s)=>this.copyButtonHandler(s,this.post.file_url))]):null,new L("source-url").name("Source").content([$("a").href(this.post.source$).content(this.post.source$.convert(e=>e.replace("https://",""))).target("_blank"),$("ion-icon").name("clipboard").on("click",(e,s)=>this.copyButtonHandler(s,this.post.source))]),new L("booru-url").name(v.name$).content([$("a").href(this.post.booruUrl$).content(this.post.booruUrl$.convert(e=>e.replace("https://",""))).target("_blank"),$("ion-icon").name("clipboard").on("click",(e,s)=>this.copyButtonHandler(s,this.post.booruUrl))]),new L("webm-url").name("Webm").hide(!0).self(async e=>{await this.post.ready,this.post.isUgoria&&e.content($("a").href(this.post.webm_url$).content(this.post.webm_url$.convert(s=>s.replace("https://",""))).target("_blank")).hide(!1)})]),$("div").class("post-tags").content(async e=>{if(this.options.tagsType==="detail"){let s=function(d,c){return c.length?[$("h3").content(d),$("section").content([c.map(p=>$("div").class("tag").content([$("a").class("tag-name").content(p.name).href(`/posts?tags=${p.name}`),$("span").class("tag-post-count").content(p.post_count$.convert(nt))]))])]:null};const i=(await this.post.fetchTags()).tags,[n,o,a,h,u]=[i.filter(d=>d.category===K.Artist),i.filter(d=>d.category===K.Character),i.filter(d=>d.category===K.General),i.filter(d=>d.category===K.Meta),i.filter(d=>d.category===K.Copyright)];return[s("Artist",n),s("Character",o),s("Copyright",u),s("Meta",h),s("General",a)]}else{let s=function(i,n){var o;return(o=n.at(0))!=null&&o.length?[$("h3").content(i),$("section").class("tag-name-only").content([n.map(a=>$("a").class("tag").content(a).href(`/posts?tags=${a}`))])]:null};return[s("Artist",this.post.tag_string_artist.split(" ")),s("Character",this.post.tag_string_character.split(" ")),s("Copyright",this.post.tag_string_copyright.split(" ")),s("Meta",this.post.tag_string_meta.split(" ")),s("General",this.post.tag_string_general.split(" "))]}})])]):this.content($("span").class("no-content").content("No Selected"))}update(e){return this.post=e,this.build(),this}copyButtonHandler(e,s){e.name("checkmark"),navigator.clipboard.writeText(s),setTimeout(()=>e.name("clipboard"),3e3)}position(e){let s=0;return addEventListener("scroll",()=>{this.inDOM()&&(s=document.documentElement.scrollTop)},{passive:!0}),e.on("beforeShift",()=>{innerWidth>800&&this.css({position:"absolute",top:`calc(${s}px + var(--nav-height) + var(--padding))`})}).on("afterShift",()=>this.css({position:"",top:""})),this}}class L extends f{constructor(e){super("div");l(this,"$name",$("span").class("property-name"));l(this,"$values",$("div").class("property-values"));this.staticClass("property").attribute("property-id",e),super.content([this.$name,this.$values.hide(!0)])}name(e){return this.$name.content(e),this}content(e){this.$values.hide(!1);const s=$.orArrayResolve(e);return this.$values.content(s.map(i=>$("span").staticClass("property-value").content(i))),this}}const ot=class ot{constructor(t){l(this,"orderMap",new Map);l(this,"cache",new Set);l(this,"limit",100);l(this,"tags");l(this,"finished",!1);l(this,"events",new C);this.tags=t,ot.managers.set(this.tags,this),v.events.on("set",()=>{this.clear(),this.finished&&(this.finished=!1)})}static get(t){const e=this.managers.get(t)??new ot(t);return this.managers.set(e.tags,e),e}clear(){this.orderMap.clear(),this.cache.clear()}addPosts(t){t=$.orArrayResolve(t);for(const e of t)e.file_url&&(this.cache.has(e)||this.cache.add(e));return this}async fetchPosts(t){const e=[],s=[];let i=this.limit,n=[];for(const o of this.tag_list)o.startsWith("ordfav:")||o.startsWith("order:")?s.push(o):o.startsWith("limit:")?i=Number(o.split(":")[1]):e.push(o);if(s.length){if(s.length>1)return this.events.fire("post_error",`Error: These query can't be used together [${s}].`),[];const o=s[0];if(o.startsWith("ordfav:")){const a=o.split(":")[1],h=e.length?`&search[post_tags_match]=${e.toString().replaceAll(",","+")}`:"",u=this.orderKeyList.length?t==="newer"?`&search[id]=>${this.orderKeyList.at(0)}`:`&search[id]=<${this.orderKeyList.at(-1)}`:void 0,d=await v.used.fetch(`/favorites.json?search[user_name]=${a}${u??""}${h}&limit=${i}`);n=await Y.fetchMultiple(v.used,{tags:`id:${d.map(p=>p.post_id).toString()}`},i);const c=new Map;for(const p of d){const g=n.find(_=>_.id===p.post_id);g&&g.file_url&&c.set(p.id,g)}this.orderMap=new Map(t==="newer"?[...c,...this.orderMap]:[...this.orderMap,...c]),this.events.fire("post_fetch",{manager:this,postList:n})}if(o.startsWith("order:")){const a=this.orderKeyList.length?t==="newer"?1:this.orderMap.size/i+1:void 0;n=await Y.fetchMultiple(v.used,{tags:this.tags},i,a);const h=new Map(n.filter(u=>u.file_url).map(u=>[u.id,u]));h.forEach((u,d)=>{this.orderMap.has(d)&&h.delete(d)}),this.orderMap=new Map(t==="newer"?[...h,...this.orderMap]:[...this.orderMap,...h]),this.events.fire("post_fetch",{manager:this,postList:n})}}else{const o=this.orderKeyList.length?t==="newer"?`a${this.orderKeyList.at(0)}`:`b${this.orderKeyList.at(-1)}`:void 0;n=await Y.fetchMultiple(v.used,{tags:this.tags},i,o);const a=new Map(n.filter(h=>h.file_url).map(h=>[h.id,h]));this.orderMap=new Map(t==="newer"?[...a,...this.orderMap]:[...this.orderMap,...a])}return!n.length&&t==="older"&&(this.finished=!0,this.cache.size?this.events.fire("endPost"):this.events.fire("noPost")),this.events.fire("post_fetch",{manager:this,postList:n}),this.addPosts(n),n}get orderKeyList(){return[...this.orderMap.keys()]}get tag_list(){return this.tags?decodeURIComponent(this.tags).split("+"):[]}};l(ot,"managers",new Map);let $t=ot;class Me extends f{constructor(e,s,i){super("video-controller");l(this,"$video");l(this,"$viewer");l(this,"duration$",$.state("00:00"));l(this,"post");this.$video=e,this.$viewer=s,this.post=i,this.build()}build(){const e=$.events();this.$video.on("timeupdate",()=>this.durationUpdate()),this.content([$("div").class("video-details").content([$("div").class("left").content([$("ion-icon").class("play").title("Play").name("play").self(s=>{this.$video.on("play",()=>s.name("pause")).on("pause",()=>s.name("play")),s.on("click",()=>this.$video.isPlaying?this.$video.pause():this.$video.play())}),$("div").class("duration").content([$("span").class("current-time").content(this.duration$),$("span").content("/"),$("span").class("total-time").content("00:00").self(s=>{this.$video.on("loadeddata",()=>{const i=xt(this.$video.duration*1e3);s.content(Number(i.hh)>0?`${i.hh}:${i.mm}:${i.ss}`:`${i.mm}:${i.ss}`)})})])]),$("div").class("right").content([$("ion-icon").class("volume").title("Volume").name("volume-high").disable(!this.post.hasSound).self(s=>{const i=()=>{this.$video.muted()?s.name("volume-mute"):s.name("volume-high")};s.on("click",()=>{this.$video.muted(!this.$video.muted()),i()})}),$("ion-icon").class("full-screen").title("Full-Screen").name("scan").self(s=>{s.on("click",()=>{document.fullscreenElement?document.exitFullscreen():this.$viewer.dom.requestFullscreen()})})])]),$("div").class("progressbar-container").content([$("div").class("progressbar").content([$("div").class("progress").self(s=>{this.$video.on("timeupdate",i=>{s.css({width:`${this.$video.currentTime()/this.$video.duration*100}%`})}),e.on("progressChange",i=>{s.css({width:`${i*100}%`})})})])]).self(s=>{const i=$.pointers($(document.body));let n=!1;i.on("down",(o,a)=>{if(!s.contains(o.$target))return o.delete();a.preventDefault(),this.$video.isPlaying&&(n=!0,this.$video.pause());const h=(o.x-s.domRect().x)/s.offsetWidth;this.$video.currentTime(h*this.$video.duration)}),i.on("move",(o,a)=>{a.preventDefault();const h=(o.x-s.domRect().x)/s.offsetWidth;this.$video.currentTime(h*this.$video.duration),e.fire("progressChange",h)}),i.on("up",(o,a)=>{n&&this.$video.play(),n=!1})})])}durationUpdate(){const e=xt(this.$video.currentTime()*1e3);this.duration$.set(Number(e.hh)>0?`${e.hh}:${e.mm}:${e.ss}`:`${e.mm}:${e.ss}`)}}class ke extends f{constructor(e){super("div");l(this,"$video",$("video"));l(this,"post");this.post=e,this.class("viewer"),this.build()}async build(){await this.post.ready,this.events.on("video_play_pause",()=>{this.$video.isPlaying?this.$video.pause():this.$video.play()}),this.content([$("div").class("viewer-panel").hide(!1).content(s=>(this.events.on("viewerPanel_hide",()=>s.hide(!0)).on("viewerPanel_show",()=>s.hide(!1)).on("viewerPanel_switch",()=>{s.hide(!s.hide())}),[$("div").class("panel").content([this.post.isVideo?new Me(this.$video,this,this.post):null,$("div").class("buttons").content([$("ion-icon").title("Favorite").name("heart-outline").self(i=>{var n;v.used.user?i.hide(!1):i.hide(!0),v.events.on("login",()=>i.hide(!1)),V.events.on("favoriteUpdate",o=>{o.favorites.has(this.post.id)?i.name("heart"):i.name("heart-outline")}),(n=v.used.user)!=null&&n.favorites.has(this.post.id)&&i.name("heart"),i.on("click",()=>{var o;(o=v.used.user)!=null&&o.favorites.has(this.post.id)?this.post.deleteFavorite():this.post.createFavorite()})}),$("ion-icon").title("Original Size").name("resize-outline").self(i=>{i.on("click",()=>{this.events.fire("original_size"),i.disable(!0)}),(!this.post.isLargeFile||this.post.isVideo)&&i.disable(!0)})])]),$("div").class("overlay")])),this.post.isVideo?this.$video.height(this.post.image_height).width(this.post.image_width).src(this.post.file_ext==="zip"?this.post.large_file_url:this.post.file_url).controls(!1).loop(!0).disablePictureInPicture(!0):$("img").height(this.post.image_height).width(this.post.image_width).self(s=>{s.once("load",()=>s.once("load",()=>s.removeClass("loading")).src(this.post.isLargeFile?this.post.large_file_url:this.post.file_url)).src(this.post.preview_file_url),s.complete||s.class("loading"),this.events.on("original_size",()=>s.src(this.post.file_url))})]),this.on("pointerleave",s=>{s.pointerType!=="touch"&&this.events.fire("viewerPanel_hide")}),this.on("pointermove",s=>{(s.pointerType==="mouse"||s.pointerType==="pen")&&this.events.fire("viewerPanel_show")});let e=null;$.pointers(this).on("up",s=>{var i;(i=this.$(":.viewer-panel .panel"))!=null&&i.contains($(s.$target))||(s.type==="mouse"?this.events.fire("video_play_pause"):(e!==null&&this.events.fire("video_play_pause"),e=setTimeout(()=>{e=null},300),this.events.fire("viewerPanel_switch")))}),$.keys($(window)).self(s=>s.if(i=>{if(!($(i.target)instanceof k)&&this.inDOM())return!0}).keydown(" ",i=>{i.preventDefault(),this.$video.isPlaying?this.$video.pause():this.$video.play()}))}}var Z;class Ee extends f{constructor(){super("slide-viewer");l(this,"pointers",new Gt(this));l(this,"$container",$("div").class("slide-container"));l(this,"slideMap",new Map);l(this,"slideId",null);z(this,Z);this.css({position:"relative"}),this.__build__(),new ResizeObserver(()=>{this.inDOM()&&(this.__render__(),this.trigger("resize"))}).observe(this.dom)}__build__(){this.content([this.$container]),this.$container.css({position:"relative",height:"100%"});let e=0,s=0;this.pointers.on("down",(i,n)=>{if(M(this,Z)&&!M(this,Z).call(this,i,n))return i.delete();e=this.$container.offsetLeft}),this.pointers.on("move",(i,n)=>{var o,a;i.direction===Bt.Horizontal&&(n.preventDefault(),s=e+i.move_x,!(s>e&&((o=this.slideList.at(0))==null?void 0:o.slideId())===this.slideId)&&(s<e&&((a=this.slideList.at(-1))==null?void 0:a.slideId())===this.slideId||this.$container.css({left:`${s}px`})))}),this.pointers.on("up",i=>{const n=this.domRect().width,o=e-this.$container.offsetLeft;i.move_x!==0&&(i.move_x<0&&i.movement_x<-2||o>n/2?this.next():i.move_x>0&&i.movement_x>2||o+n<n/2?this.prev():(s=e,this.__slideAnimate__()))})}addSlides(e){if(e=$.orArrayResolve(e),!!e.length){for(const s of e)s instanceof Array?this.addSlides(s):(this.slideMap.set(s.slideId(),s),this.$container.insert(s));return this.__render__(),this}}arrange(e){const s=new Map;return e.forEach(i=>{const n=this.slideMap.get(i);n&&s.set(i,n)}),this.slideMap=s,this.__render__(),this}switch(e){if(e===void 0)return this;const s=this.slideMap.get(e);if(!s)throw"target undefined";return s.slideId()===this.slideId?this:(this.events.fire("beforeSwitch",{prevSlide:this.currentSlide,nextSlide:s}),this.slideId=e,this.__slideAnimate__(),this.events.fire("switch",{nextSlide:s}),this)}__slideAnimate__(){const e=this.currentSlide?this.slideList.indexOf(this.currentSlide):void 0;if(e===void 0)return;const s=Math.abs(this.getPositionLeft(e)-this.$container.offsetLeft)===this.dom.clientWidth;this.$container.animate({left:`-${this.getPositionLeft(e)}px`},{duration:300,easing:s?"ease":"ease-out"},i=>{this.$container.css({left:`-${this.getPositionLeft(e)}px`}),this.__render__(!1)})}__navigation__(e){var h;const s=this.currentSlide,i=this.slideList,n=s?i.indexOf(s):void 0;if(n===void 0)return this.switch((h=i.at(0))==null?void 0:h.slideId()),this;const o=$.call(()=>{switch(e){case"next":return n===i.length?n:n+1;case"prev":return n===0?n:n-1}}),a=this.slideList.at(o);return this.switch(a==null?void 0:a.slideId()),this}next(){return this.__navigation__("next")}prev(){return this.__navigation__("prev")}get currentSlide(){return this.slideId?this.slideMap.get(this.slideId):void 0}get slideIdList(){return Array.from(this.slideMap.keys())}get slideList(){return Array.from(this.slideMap.values())}getPositionLeft(e){return e*this.dom.clientWidth}__render__(e=!0){var n,o;let s=0;if(this.slideMap.forEach(a=>{a.hide(!0,!1),a.css({top:"0",left:`${this.getPositionLeft(s)}px`}),s++}),!this.currentSlide)return;const i=this.slideList.indexOf(this.currentSlide);this.currentSlide.build().hide(!1,!1),i!==0&&((n=this.slideList.at(i-1))==null||n.build().hide(!1,!1)),i!==this.slideList.length-1&&((o=this.slideList.at(i+1))==null||o.build().hide(!1,!1)),this.$container.children.render(),e&&this.$container.css({left:`-${this.getPositionLeft(i)}px`})}pointerException(e){return D(this,Z,e),this}}Z=new WeakMap;var tt,ct;class Le extends f{constructor(){super("slide");z(this,tt);l(this,"builded",!1);z(this,ct);this.css({width:"100%",height:"100%",display:"block",position:"absolute"})}builder(e){return D(this,tt,e),this}build(){return!this.builded&&M(this,tt)&&(this.content(M(this,tt).call(this)),this.builded=!0),this}slideId(e){return $.fluent(this,arguments,()=>M(this,ct),()=>D(this,ct,e))}}tt=new WeakMap,ct=new WeakMap;const Pe=$("route").path("/posts/:id?q").static(!1).builder(({$page:r,params:t})=>{if(!Number(t.id))return r.content($("h1").content("404: POST NOT FOUND"));const e=$.events();let s,i;$.keys($(window)).self(u=>u.if(d=>{if(!($(d.target)instanceof k)&&r.inDOM())return!0}).keydown(["f","F"],d=>{var c;(c=v.used.user)!=null&&c.favorites.has(s.id)?s.deleteFavorite():s.createFavorite()}).keydown(["a","A"],d=>a("prev")).keydown(["d","D"],d=>{a("next")}));const n=new Map;r.on("open",async({params:u,query:d})=>{var p;if(i=$t.get(d.q),s=Y.get(v.used,+u.id),i.events.on("post_fetch",h),!i.orderMap.size||!i.cache.has(s)){await s.ready,i.addPosts(s);const g=(p=i.tag_list)==null?void 0:p.find(_=>_.startsWith("ordfav"));if(g){const _=g.split(":")[1],T=await v.used.fetch(`/favorites.json?search[user_name]=${_}&search[post_id]=${s.id}`);T[0]&&i.orderMap.set(T[0].id,s)}else i.orderMap.set(s.id,s);i.fetchPosts("newer"),i.fetchPosts("older")}else{const g=[...i.orderMap.values()],_=g.indexOf(s);!i.finished&&_===g.length-1?i.fetchPosts("older"):_===0&&i.fetchPosts("newer")}h({manager:i}),o(i.tags).switch(s.id),e.fire("post_switch",s)});function o(u){const d=n.get(u)??new Ee().pointerException(c=>{var p;return!((p=d.currentSlide)!=null&&p.$("::.progressbar-container").find(g=>g.contains(c.$target))||c.type==="mouse")}).on("switch",({nextSlide:c})=>{$.replace(`/posts/${c.slideId()}${u?`?q=${u}`:""}`)}).on("beforeSwitch",({prevSlide:c,nextSlide:p})=>{const g=c==null?void 0:c.$(":video");g!=null&&g.isPlaying&&g.pause();const _=p.$(":video");(_==null?void 0:_.isPlaying)===!1&&_.play()});return n.set(u,d),d}function a(u){const d=[...i.orderMap.values()],c=d.indexOf(s);if(u==="prev"&&c===0)return;const p=d.at(u==="next"?c+1:c-1);p&&$.replace(`/posts/${p.id}${i.tags?`?q=${i.tags}`:""}`)}function h(u){const{manager:d}=u,c=o(d.tags),p=d.cache.array.filter(g=>!c.slideMap.has(g.id));c.addSlides(p.map(g=>new Le().slideId(g.id).builder(()=>new ke(g)))),p.length&&c.arrange([...d.orderMap.values()].map(g=>g.id))}return r.id("post").content([$("div").class("slide-viewer-container").self(u=>{r.on("open",()=>{u.content(o(i.tags))})}),$("div").class("content").content([$("h3").content("Artist's Commentary"),$("section").class("commentary").self(async u=>{e.on("post_switch",async d=>{const c=(await Qt.fetchMultiple(v.used,{post:{_id:d.id}})).at(0);u.content([c?[c.original_title?$("h3").content(c.original_title):null,$("pre").content(c.original_description)]:"No commentary"])})})]),new Jt().hide(X.convert(u=>!u)).position(r).self(u=>{e.on("post_switch",c=>u.update(c)),d(),X.on("update",({state$:c})=>d());function d(){X.value?r.removeStaticClass("side-panel-disable"):r.addStaticClass("side-panel-disable")}})])});class St extends f{constructor(e,s){super("post-tile");l(this,"post");l(this,"$video");l(this,"$img");l(this,"duration$",$.state(""));l(this,"$grid");this.$grid=e,this.post=s,this.$video=this.post.isVideo?$("video").width(this.post.image_width).height(this.post.image_height).disablePictureInPicture(!0).loop(!0).muted(!0).hide(!0).on("mousedown",i=>i.preventDefault()):null,this.$img=$("img").draggable(!1).css({opacity:"0"}).width(this.post.image_width).height(this.post.image_height).src(this.post.previewURL).loading("lazy"),this.attribute("filetype",this.post.file_ext),this.durationUpdate(),this.build()}build(){var e;(e=this.$video)==null||e.on("timeupdate",(s,i)=>{this.durationUpdate()}),this.class("loading").content([this.post.isVideo?$("div").class("video-detail").content([this.post.hasSound?$("ion-icon").name("volume-medium-outline"):null,this.post.isUgoria?$("ion-icon").name("images-outline"):null,$("span").class("duration").content(this.duration$)]):null,this.post.isGif?$("div").class("gif-detail").content([$("span").content("GIF")]):null,$("a").href(this.url).preventDefault(j).content(()=>[this.$video,this.$img.on("mousedown",s=>s.preventDefault()).once("load",(s,i)=>{i.animate({opacity:[0,1]},{duration:300},()=>i.css({opacity:""})),this.removeClass("loading")})])]),this.on(["focus","mouseenter","touchstart"],()=>{var s,i;(s=this.$video)!=null&&s.isPlaying||(i=this.$video)==null||i.src(this.post.large_file_url).hide(!1).play().catch(n=>{}),this.post.isGif&&this.$img.src(this.post.large_file_url)},{passive:!0}).on(["blur","mouseleave","touchend","touchcancel"],()=>{var s;(s=this.$video)==null||s.pause().currentTime(0).hide(!0),this.post.isGif&&this.$img.src(this.post.previewURL)},{passive:!0}).on("click",()=>{if(j.value){if(innerWidth<=800)return $.open(this.url);this.attribute("focus")===""?$.open(this.url):this.trigger("$focus")}})}durationUpdate(){if(!this.$video)return;const e=xt(this.post.media_asset.duration*1e3-this.$video.currentTime()*1e3);this.duration$.set(Number(e.hh)>0?`${e.hh}:${e.mm}:${e.ss}`:`${e.mm}:${e.ss}`)}get url(){return`${this.post.pathname}${this.$grid.tags?`?q=${this.$grid.tags}`:""}`}}class Ae extends Kt{constructor(e){super();l(this,"$postMap",new Map);l(this,"tags");l(this,"$focus",$.focus());l(this,"posts");this.tags=e==null?void 0:e.tags,this.posts=$t.get(this.tags),this.addStaticClass("post-grid"),this.type("waterfall").gap(10),this.init()}async init(){this.posts.events.on("post_fetch",s=>{this.renderPosts()});const e=setInterval(async()=>{if(this.posts.tag_list.includes("order:random"))return clearInterval(e);this.inDOM()&&document.documentElement.scrollTop===0&&await this.posts.fetchPosts("newer")},1e4);v.events.on("set",()=>{this.removeAll(),this.loader()}),this.on("resize",()=>this.resize()),this.loader(),this.$focus.layer(100).loop(!1).scrollThreshold($.rem(2)+60),$.keys($(window)).if(s=>{if(this.inDOM()&&!($(s.target)instanceof k))return!0}).keydown(["w","W"],s=>{s.preventDefault(),this.$focus.up()}).keydown(["s","S"],s=>{s.preventDefault(),this.$focus.down()}).keydown(["d","D"],s=>{s.preventDefault(),this.$focus.right()}).keydown(["a","A"],s=>{s.preventDefault(),this.$focus.left()}).keydown([" ","Enter"],s=>{var n;s.preventDefault();const i=(n=this.$focus.currentLayer)==null?void 0:n.currentFocus;i instanceof St&&$.open(i.url)}).keydown(["Escape"],s=>{s.preventDefault(),this.$focus.blur()})}async loader(){if(!this.inDOM())return setTimeout(()=>this.loader(),100);for(;this.inDOM()&&document.documentElement.scrollHeight<=innerHeight*2;)if(!(await this.posts.fetchPosts("older")).length)return;document.documentElement.scrollTop+innerHeight>document.documentElement.scrollHeight-innerHeight*2&&!(await this.posts.fetchPosts("older")).length||setTimeout(()=>this.loader(),100)}resize(){const e=Math.round(this.dom.clientWidth/300);this.column(e>=2?e:2)}renderPosts(){this.$focus.layer(100).elementSet.clear();const e=[...this.posts.orderMap.values()].map(s=>{const i=this.$postMap.get(s)??new St(this,s).on("$focus",(n,o)=>this.$focus.layer(100).focus(o));return this.$postMap.set(s,i),i.self(this.$focus.layer(100).add)});return this.content(e).render(),this}removeAll(){return this.$postMap.clear(),this.$focus.layer(100).removeAll(),this.animate({opacity:[1,0]},{duration:300,easing:"ease"},()=>this.clear().render()),this}}class Yt{static async fetch(t,e,s=20){if(!e.length)return this.searchQuery.map(o=>new Ct(o));const i=await t.fetch(`/autocomplete.json?search[query]=${e}&search[type]=tag_query&version=1&limit=${s}`);return[...e.length?this.searchQuery.filter(o=>o.value.startsWith(e)&&o.value!==e):this.searchQuery,...i].map(o=>new Ct(o))}}l(Yt,"searchQuery",[{value:"user:",label:"user:"},{value:"approver:",label:"approver:"},{value:"-approver:",label:"-approver:"},{value:"order:",label:"order:"},{value:"ordfav:",label:"ordfav:"},{value:"ordfavgroup:",label:"ordfavgroup:"},{value:"search:",label:"search:"},{value:"favgroup:",label:"favgroup:"},{value:"-favgroup:",label:"-favgroup:"},{value:"favcount:",label:"favcount:"},{value:"id:",label:"id:"},{value:"tagcount:",label:"tagcount:"},{value:"gentags:",label:"gentags:"},{value:"arttags:",label:"arttags:"},{value:"chartags:",label:"chartags:"},{value:"copytags:",label:"copytags:"},{value:"metatags:",label:"metatags:"},{value:"score:",label:"score:"},{value:"upvote:",label:"upvote:"},{value:"downvote:",label:"downvote:"},{value:"disapproved:",label:"disapproved:"},{value:"md5:",label:"md5:"},{value:"width:",label:"width:"},{value:"height:",label:"height:"},{value:"ratio:",label:"ratio:"},{value:"mpixels:",label:"mpixels:"},{value:"filesize:",label:"filesize:"},{value:"duration:",label:"duration:"},{value:"is:",label:"is:"},{value:"has:",label:"has:"},{value:"pool:",label:"pool:"},{value:"-pool:",label:"-pool:"},{value:"ordpool:",label:"ordpool:"},{value:"random:",label:"random:"},{value:"limit:",label:"limit:"},{value:"date:",label:"date:"},{value:"commenter:",label:"commenter:"},{value:"note:",label:"note:"},{value:"noter:",label:"noter:"},{value:"noteupdater:",label:"noteupdater:"},{value:"status:",label:"status:"},{value:"-status:",label:"-status:"},{value:"rating:",label:"rating:"},{value:"-rating:",label:"-rating:"},{value:"source:",label:"source:"},{value:"-source:",label:"-source:"},{value:"pixiv:",label:"pixiv:"},{value:"parent:",label:"parent:"},{value:"child:",label:"child:"},{value:"flagger:",label:"flagger:"},{value:"appealer:",label:"appealer:"},{value:"commentary:",label:"commentary:"},{value:"commentaryupdater:",label:"commentaryupdater:"}].map(t=>({type:"query",...t})));class Ct{constructor(t){Object.assign(this,t)}isTag(){return this.type==="tag"||this.type==="tag-autocorrect"||this.type==="tag-alias"||this.type==="tag-word"}isTagAutocorrect(){return this.type==="tag-autocorrect"}isTagAntecedent(){return!!this.antecedent}isTagWord(){return this.type==="tag-word"}isUser(){return this.type==="user"}}class Ce extends f{constructor(){super("searchbar");l(this,"$tagInput",new He(this));l(this,"$selectionList",new De);l(this,"typingTimer",null);l(this,"$filter",$("div").class("filter"));this.build(),$.keys($(window)).keydown("/",e=>{e.preventDefault(),this.open()}).keyup("Escape",e=>{this.inDOM()&&e.preventDefault(),this.close()})}build(){this.content([$("div").class("input-container").content([this.$tagInput.on("input",()=>this.inputHandler()).on("keydown",e=>this.keyHandler(e)),$("ion-icon").name("close-circle-outline").title("Clear Input").on("click",()=>this.$tagInput.clearAll())]).on("click",e=>{e.target===this.$tagInput.dom&&this.$tagInput.addTag().input()}),$("div").class("selection-list-container").content([this.$selectionList]),this.$filter.on("click",()=>{location.hash==="#search"&&this.close()})])}open(){return location.hash!=="#search"&&$.open(location.href+"#search"),this}close(){return location.hash==="#search"&&$.back(),this}activate(){return this.hide(!1),this.$filter.animate({opacity:[0,.5]},{duration:300,easing:"ease"}),this.$tagInput.input(),this}inactivate(){return this.animate({opacity:[.5,0]},{duration:300,easing:"ease"},()=>this.hide(!0)),this}keyHandler(e){var n,o;const s=()=>{e.preventDefault(),this.$tagInput.addTag().input()},i=a=>{const h=this.$tagInput.children.indexOf(this.$tagInput.$inputor);if(this.$tagInput.$input.value().at(-1)===":")return this.getSearchSuggestions();const u=this.$tagInput.children.array.at(h+1);this.$tagInput.addTag(a.value()),u?this.$tagInput.editTag(u):this.$tagInput.input()};switch(e.key){case"ArrowUp":{e.preventDefault(),this.$selectionList.focusPrevSelection(),this.$tagInput.value((n=this.$selectionList.focused)==null?void 0:n.value());break}case"ArrowDown":{e.preventDefault(),this.$selectionList.focusNextSelection(),this.$tagInput.value((o=this.$selectionList.focused)==null?void 0:o.value());break}case" ":s();break;case"Enter":{e.preventDefault(),this.$selectionList.focused?i(this.$selectionList.focused):(this.$tagInput.addTag(),this.search());break}case"Tab":{e.preventDefault();const a=this.$tagInput.children.indexOf(this.$tagInput.$inputor);if(e.shiftKey){a-1>=0&&this.$tagInput.editTag(this.$tagInput.children.array.at(a-1));break}if(this.$selectionList.focused)i(this.$selectionList.focused);else{const h=this.$tagInput.children.array.at(a+1);h?this.$tagInput.editTag(h):this.$tagInput.addTag().input()}break}case"Backspace":{const a=this.$tagInput.children.indexOf(this.$tagInput.$inputor);a!==0&&!this.$tagInput.$input.value().length&&(e.preventDefault(),this.$tagInput.editTag(this.$tagInput.children.array.at(a-1)));break}}}inputHandler(){this.typingTimer&&(clearTimeout(this.typingTimer),this.typingTimer=null),this.typingTimer=setTimeout(async()=>{this.typingTimer=null,this.getSearchSuggestions()},200)}async getSearchSuggestions(){const e=this.$tagInput.$input.value(),s=await Yt.fetch(v.used,e,20);this.$selectionList.clearSelections().addSelections(s.map(i=>new Re().value(i.value).content([$("div").class("selection-label").content([i.isTagAntecedent()?$("span").class("tag-antecedent").self(n=>n.dom.innerHTML=i.antecedent.replaceAll(e,`<b>${e}</b>`)):null,$("div").class("label-container").content([i.isTagAntecedent()?$("ion-icon").name("arrow-forward-outline"):null,$("span").class("label").self(n=>n.dom.innerHTML=i.label.replaceAll(e,`<b>${e}</b>`))])]),i.isTag()?$("div").class("tag-detail").content([$("span").class("tag-post-count").content(nt(i.post_count)),$("span").class("tag-category").content(K[i.category])]):null,i.isUser()?$("span").class("user-level").content(i.level):null]).on("click",()=>{this.$tagInput.addTag(i.value).input()})))}search(){return $.replace(`/posts?tags=${this.$tagInput.query.replace(":","%3A")}`),this.$tagInput.clearAll(),this.inactivate(),this}checkURL(e,s){if((e==null?void 0:e.hash)==="#search"&&this.inactivate(),s.hash==="#search"&&this.activate(),`${e==null?void 0:e.pathname}${e==null?void 0:e.search}`==`${s.pathname}${s.search}`)return;const i=s.searchParams.get("tags");this.$tagInput.clearAll(),i==null||i.split(" ").forEach(n=>this.$tagInput.addTag(n))}}class De extends f{constructor(){super("selection-list");l(this,"focused",null);l(this,"selections",new Set)}addSelections(e){e=$.orArrayResolve(e);for(const s of e)this.selections.add(s);return this.insert(e),this}clearSelections(){return this.focused=null,this.selections.clear(),this.clear(),this}focusSelection(e){return this.blurSelection(),this.focused=e,e.focus(),e.offsetTop<this.scrollTop()&&this.scrollTop(e.offsetTop),e.offsetTop+e.offsetHeight>this.scrollTop()+this.offsetHeight&&this.scrollTop(e.offsetTop+e.offsetHeight-this.offsetHeight),this}blurSelection(){var e;return(e=this.focused)==null||e.blur(),this.focused=null,this}focusNextSelection(){const e=this.selections.array,s=e.at(0);if(this.focused){const i=e.at(e.indexOf(this.focused)+1);i?this.focusSelection(i):s&&this.focusSelection(s)}else s&&this.focusSelection(s)}focusPrevSelection(){const e=this.selections.array;if(this.focused){const s=e.at(e.indexOf(this.focused)-1);s&&this.focusSelection(s)}else{const s=e.at(0);s&&this.focusSelection(s)}}}class Re extends f{constructor(){super("selection");l(this,"property",{value:""})}value(e){return $.fluent(this,arguments,()=>this.property.value,()=>$.set(this.property,"value",e))}focus(){return this.addClass("active"),this}blur(){return this.removeClass("active"),this}}class He extends f{constructor(e){super("tag-input");l(this,"$input",$("input").type("text"));l(this,"$sizer",$("span").class("sizer"));l(this,"$inputor",$("div").class("input-wrapper").content([this.$sizer,this.$input.on("input",()=>{this.$sizer.content(this.$input.value())})]));l(this,"tags",new Set);l(this,"$seachbar");this.$seachbar=e}input(){return this.insert(this.$inputor),this.$input.focus(),this.$seachbar.$selectionList.clearSelections(),this.$seachbar.getSearchSuggestions(),this}addTag(e){if(e=e??this.$input.value(),!e.length)return this;const s=new Ne(e);return s.on("click",()=>this.editTag(s)),this.tags.add(s),this.value(""),this.$input.inDOM()?this.$inputor.replace(s):this.insert(s),this}editTag(e){return this.addTag(),this.tags.delete(e),e.replace(this.$inputor),this.value(e.name),this.$input.focus(),this.$seachbar.getSearchSuggestions(),this}clearAll(){return this.value(""),this.tags.clear(),this.clear(),this}value(e){return e===void 0?this:(this.$input.value(e),this.$sizer.content(e),this)}focus(){return this.$input.focus(),this}get query(){return this.tags.array.map(e=>e.name).toString().toLowerCase().replace(",","+")}}class Ne extends f{constructor(e){super("tag");l(this,"name");this.name=e,this.build()}build(){this.content(this.name)}}class Fe extends f{constructor(){super("ion-icon")}name(t){return this.attribute("name",t),this}size(t){return this.attribute("size",t),this}disable(t){return this.attribute("disable",t),this}link(t,e=!1){return this.on("click",()=>e?$.replace(t):$.open(t)),this}}class Ve extends Ot{constructor(){super();l(this,"$icon",$("ion-icon"));l(this,"$label",$("span"));this.addStaticClass("icon"),this.build()}build(){super.content([this.$icon.hide(!0),this.$label])}content(e){return this.$label.content(e),this}icon(e){return this.$icon.name(e).hide(!1),this}link(e,s=!1){return this.on("click",()=>s?$.replace(e):$.open(e)),this}}const je=$("route").path("/login").builder(({$page:r})=>{const[t,e]=[$.state(""),$.state("")];return r.id("login").content([$("div").class("login-container").content([$("h1").content("Login"),$("div").class("username","input-container").content([$("label").for("username").content("Username"),$("input").type("text").id("username").value(t)]),$("div").class("api-key","input-container").content([$("label").for("api-key").content("API Key"),$("input").type("password").id("api-key").value(e)]),$("icon-button").content("Login").on("click",async()=>{await v.used.login(t.value,e.value),v.used.user&&(V.storageUserData={apiKey:e.value,username:t.value},t.set(""),e.set(""),$.replace("/"))}),$("icon-button").content("Create Account").icon("open-outline").on("click",()=>$.open("https://danbooru.donmai.us/users/new","_blank"))])])});class We extends f{constructor(){super("drawer");l(this,"$filter",$("div").class("filter"));l(this,"$container",$("div").class("drawer-container"));l(this,"pointers",$.pointers($(document.body)));l(this,"opened",!1);this.hide(!0),this.build()}build(){this.content([this.$container.content([$("div").class("user-info").hide(!0).self(e=>[v.events.on("login",s=>{e.content([$("div").content([$("h3").class("username").content(s.name$),$("div").class("user-detail").content([$("span").class("userid").content(`ID: ${s.id}`),$("span").class("level").content(["Level: ",s.level_string$])])]),$("div").class("user-nav").content([$("icon-button").title("Uploaded Posts").icon("image").content(s.post_upload_count$.convert(nt)).link(`/posts?tags=user:${s.name}`,!0),$("icon-button").title("Favorites").icon("heart").content(s.favorite_count$.convert(nt)).link(`/posts?tags=ordfav:${s.name}`,!0),$("icon-button").title("Forum Posts").icon("document-text").content(s.forum_post_count$.convert(nt)).hide(!0)])]).hide(!1)}).on("logout",()=>{e.clear().hide(!0)})]),$("div").class("nav").content([$("icon-button").icon("log-in-outline").content("Login").link("/login",!0).self(e=>v.events.on("login",()=>e.hide(!0)).on("logout",()=>e.hide(!1))),$("icon-button").icon("log-in-outline").content("Logout").on("dblclick",()=>v.used.logout()).hide(!0).self(e=>v.events.on("login",()=>e.hide(!1)).on("logout",()=>e.hide(!0))),$("icon-button").icon("swap-horizontal").class("switch").content("Switch Booru").on("click",()=>{v.used===Tt?v.set(Ue):v.set(Tt),this.close()})])]),this.$filter.on("click",()=>$.back())]),this.pointers.on("move",e=>{var s;(s=$(":slide-viewer"))!=null&&s.contains(e.$target)||(e.$target.parent,!(e.type!=="pen"&&e.type!=="touch")&&(e.move_y>4||e.move_y<-4||(e.move_x<=-7&&(e.delete(),this.open()),e.move_x>=7&&(e.delete(),this.close()))))})}open(){return location.hash!=="#drawer"&&$.open(location.href+"#drawer"),this}close(){return location.hash==="#drawer"&&$.back(),this}activate(){this.opened=!0,this.hide(!1),this.$container.animate({transform:["translateX(100%)","translateX(0%)"]},{fill:"both",duration:300,easing:"ease"}),this.$filter.animate({opacity:[0,1]},{fill:"both",duration:300,easing:"ease"})}inactivate(){this.opened=!1,this.$container.animate({transform:["translateX(0%)","translateX(100%)"]},{fill:"both",duration:300,easing:"ease"},()=>this.hide(!this.opened)),this.$filter.animate({opacity:[1,0]},{fill:"both",duration:300,easing:"ease"})}checkURL(e,s){(e==null?void 0:e.hash)==="#drawer"&&this.inactivate(),s.hash==="#drawer"&&this.activate()}}class vt{static get previewPanelEnabled(){var t;return(t=this.localdata)==null?void 0:t.previewPanelEnabled}static set previewPanelEnabled(t){this.localdata={...this.localdata,previewPanelEnabled:t}}static get detailPanelEnabled(){var t;return(t=this.localdata)==null?void 0:t.detailPanelEnabled}static set detailPanelEnabled(t){this.localdata={...this.localdata,detailPanelEnabled:t}}static get localdata(){const t=localStorage.getItem("local_settings_data");return t?JSON.parse(t):null}static set localdata(t){localStorage.setItem("local_settings_data",JSON.stringify(t))}}$.registerTagName("ion-icon",Fe);$.registerTagName("icon-button",Ve);$.registerTagName("a",Xt);const[Tt,Ue]=[new v({origin:"https://danbooru.donmai.us",name:"Danbooru"}),new v({origin:"https://safebooru.donmai.us",name:"Safebooru"}),new v({origin:"https://testbooru.donmai.us",name:"Testbooru"})];v.set(v.manager.get(v.storageAPI??"")??Tt);const ft=new Ce().hide(!0),It=new We,j=$.state(vt.previewPanelEnabled??!1).on("update",({state$:r})=>vt.previewPanelEnabled=r.value),X=$.state(vt.detailPanelEnabled??!0).on("update",({state$:r})=>vt.detailPanelEnabled=r.value);$(document.body).content([$("nav").content([$("a").class("title").href("/").content([$("h1").class("booru-name").content(v.name$),$("h2").class("app").content([$("span").class("app-name").content("Viewer"),$("span").class("version").content("v0.14.8")])]),$("div").class("searchbar").content(["Search in ",v.name$]).self(r=>O.events.on("stateChange",({beforeURL:t,afterURL:e})=>{t.hash==="#search"&&r.hide(!1),e.hash==="#search"&&r.hide(!0)})).on("click",()=>ft.open()),$("div").class("buttons").content([$("ion-icon").class("search").name("search-outline").title("Search").self(r=>O.events.on("stateChange",({beforeURL:t,afterURL:e})=>{t.hash==="#search"&&r.hide(!1),e.hash==="#search"&&r.hide(!0)})).on("click",()=>ft.open()),$("ion-icon").class("detail-panel").name("reader-outline").title("Toggle Detail Panel").on("click",()=>{$(":page#posts")?j.set(!j.value):$(":page#post")&&X.set(!X.value)}),$("a").content($("ion-icon").class("open").name("open-outline").title("Open in Original Site")).href(location.href.replace(location.origin,v.used.origin)).target("_blank"),$("ion-icon").class("copy").name("link-outline").title("Copy Page Link").hide(!1).on("click",(r,t)=>{navigator.clipboard.writeText(`${location.origin}${location.pathname}${location.search}`),t.name("checkmark-outline"),setTimeout(()=>{t.name("link-outline")},2e3)}),$("ion-icon").class("menu").name("menu-outline").title("Menu").hide(!1).self(r=>{v.events.on("login",()=>r.hide(!0)).on("logout",()=>r.hide(!1))}).on("click",()=>$.open(location.href+"#drawer")),$("div").class("account").hide(!0).title("Menu").self(r=>{v.events.on("login",t=>{r.content(t.name$.convert(e=>{var s;return((s=e.at(0))==null?void 0:s.toUpperCase())??""})).hide(!1)}).on("logout",()=>r.hide(!0))}).on("click",()=>It.open())])]),ft,It,$("router").base("/").map([$("route").path(["/","/posts"]).builder(({$page:r,query:t})=>{const{$postGrid:e,$detail:s}=Dt(r,t);return r.id("posts").content([e,s])}),$("route").path("/posts?tags").builder(({$page:r,query:t})=>{const{$postGrid:e,$detail:s}=Dt(r,t);return r.id("posts").content([$("header").content([$("h2").content("Posts"),$("div").class("tags").self(i=>{t.tags.split("+").forEach(n=>{i.insert($("a").class("tag").content(decodeURIComponent(n)).href(`posts?tags=${n}`))})})]),$("div").class("no-post").hide(!0).self(i=>{i.on("startLoad",()=>i.hide(!0)),e.self(()=>{e.posts.events.on("noPost",()=>i.hide(!1).content("No Posts")).on("post_error",n=>i.hide(!1).content(n))})}),e,s])}),Pe,je]).on("beforeSwitch",r=>{r.preventDefault();function s(){var o;$(document.documentElement).css({scrollBehavior:"auto"});const n=$.call(()=>{switch(O.navigationDirection){case B.Forward:return["translateX(2%)","translateX(0%)"];case B.Back:return["translateX(-2%)","translateX(0%)"];case B.Replace:return""}});r.$view.content(r.nextContent),r.rendered(),(o=r.nextContent.element)==null||o.class("animated").animate({opacity:[0,1],transform:n},{duration:300,easing:"ease"},()=>{var a;r.switched(),$(document.documentElement).css({scrollBehavior:""}),(a=r.nextContent.element)==null||a.removeClass("animated")})}function i(){var o,a;$(document.documentElement).css({scrollBehavior:"auto"});const n=$.call(()=>{switch(O.navigationDirection){case B.Forward:return["translateX(0%)","translateX(-2%)"];case B.Back:return["translateX(0%)","translateX(2%)"];case B.Replace:return""}});(a=(o=r.previousContent)==null?void 0:o.element)==null||a.class("animated").animate({opacity:[1,0],transform:n},{duration:300,easing:"ease"},()=>{var h,u;(u=(h=r.previousContent)==null?void 0:h.element)==null||u.removeClass("animated"),s()})}r.previousContent?i():s()})]);O.events.on("stateChange",({beforeURL:r,afterURL:t})=>Zt(r,t));Zt(void 0,new URL(location.href));function Zt(r,t){ft.checkURL(r,t),It.checkURL(r,t)}function Dt(r,t){const e=new Ae(t),s=new Jt({preview:!0,tagsType:"name_only"}).hide(j.convert(n=>!n)).position(r);i(),j.on("update",i),v.events.on("set",()=>s.update(null));function i(){j.value?e.addClass("detail-panel-enabled"):e.removeClass("detail-panel-enabled")}return e.$focus.on("focus",({$focused:n})=>{n.inDOM()&&n instanceof St&&s.update(n.post)}).on("blur",()=>s.update(null)),{$postGrid:e,$detail:s}}$.keys($(window)).if(r=>{if(!($(r.target)instanceof k))return!0}).keydown(["q","Q"],r=>{r.preventDefault(),O.index!==0&&$.back()}).keydown(["e","E"],r=>{r.preventDefault(),O.forwardIndex!==0&&$.forward()}).keydown("Tab",r=>{r.preventDefault(),$(":page#posts")?j.set(!j.value):$(":page#post")&&X.set(!X.value)});
